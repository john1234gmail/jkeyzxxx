(function(g){var window=this;'use strict';var j4F=function(h){var e=new g.yg("und",new g.rC("Default","und",!0));e.captionTracks=h.captionTracks;return e},RzL=function(h){return new g.xD(function(e,t){var Q=h.length,N=[];
if(Q)for(var f=function(U,q){Q--;N[U]=q;Q==0&&e(N)},V=function(U){t(U)},R,u=0;u<h.length;u++)R=h[u],g.abO(R,g.vB(f,u),V);
else e(N)})},DF=function(h){this.D=h},kM=function(){DF.apply(this,arguments)},uVf=function(){kM.apply(this,arguments)},UTL=function(){kM.apply(this,arguments)},q8E=function(){kM.apply(this,arguments)},r6L=function(){kM.apply(this,arguments)},A6T=function(){kM.apply(this,arguments)},zzt=function(){kM.apply(this,arguments)},S8Z=function(){DF.apply(this,arguments)},J6f=function(){kM.apply(this,arguments)},c6F=function(){kM.apply(this,arguments)},IkS=function(){kM.apply(this,arguments)},lkS=function(){kM.apply(this,
arguments)},iLH=function(){kM.apply(this,arguments)},xTf=function(){kM.apply(this,arguments)},W7Z=function(){kM.apply(this,arguments)},TyL=function(){kM.apply(this,arguments)},OL5=function(){kM.apply(this,arguments)},gjn=function(){kM.apply(this,arguments)},dTH=function(){kM.apply(this,arguments)},wrc=function(){kM.apply(this,arguments)},XrE=function(){DF.apply(this,arguments)},ZLf=function(){kM.apply(this,arguments)},F7Z=function(){kM.apply(this,arguments)},Y8S=function(){kM.apply(this,arguments)},
njn=function(){kM.apply(this,arguments)},DTS=function(){kM.apply(this,arguments)},kCH=function(){kM.apply(this,arguments)},prZ=function(){kM.apply(this,arguments)},$T9=function(){kM.apply(this,arguments)},K7Z=function(){kM.apply(this,arguments)},HLL=function(){DF.apply(this,arguments)},EjF=function(){DF.apply(this,arguments)},mTE=function(){DF.apply(this,arguments)},Byt=function(){kM.apply(this,arguments)},bLc=function(){kM.apply(this,arguments)},PbZ=function(){kM.apply(this,arguments)},Mtn=function(){kM.apply(this,
arguments)},Cb5=function(){kM.apply(this,arguments)},GCS=function(){kM.apply(this,arguments)},L7t=function(){kM.apply(this,arguments)},akf=function(){kM.apply(this,arguments)},vjL=function(){kM.apply(this,arguments)},s7f=function(){kM.apply(this,arguments)},hGL=function(){kM.apply(this,arguments)},oa5=function(){kM.apply(this,arguments)},eGH=function(){kM.apply(this,arguments)},tG5=function(){kM.apply(this,arguments)},Q7S=function(){kM.apply(this,arguments)},NZt=function(){kM.apply(this,arguments)},
f4S=function(){kM.apply(this,arguments)},VGE=function(){kM.apply(this,arguments)},yaT=function(){kM.apply(this,arguments)},j7T=function(){kM.apply(this,arguments)},RGZ=function(){kM.apply(this,arguments)},u05=function(){kM.apply(this,arguments)},UnE=function(){kM.apply(this,arguments)},qt9=function(){kM.apply(this,arguments)},raZ=function(){kM.apply(this,arguments)},AaS=function(){kM.apply(this,arguments)},zGF=function(){DF.apply(this,arguments)},StR=function(){kM.apply(this,arguments)},Jat=function(){kM.apply(this,
arguments)},ca5=function(){kM.apply(this,arguments)},I4c=function(){kM.apply(this,arguments)},l4T=function(){kM.apply(this,arguments)},ibZ=function(){kM.apply(this,arguments)},xnT=function(){kM.apply(this,arguments)},WiF=function(){kM.apply(this,arguments)},TZT=function(){kM.apply(this,arguments)},Obn=function(){kM.apply(this,arguments)},gaS=function(){kM.apply(this,arguments)},dnc=function(){kM.apply(this,arguments)},wSZ=function(){kM.apply(this,arguments)},XSE=function(){kM.apply(this,arguments)},
ZbE=function(){kM.apply(this,arguments)},FiT=function(){kM.apply(this,arguments)},Ytf=function(){kM.apply(this,arguments)},naT=function(){kM.apply(this,arguments)},DnR=function(){kM.apply(this,arguments)},kkL=function(){kM.apply(this,arguments)},pSc=function(){kM.apply(this,arguments)},$n9=function(){kM.apply(this,arguments)},KiT=function(){kM.apply(this,arguments)},Hbc=function(){kM.apply(this,arguments)},Ea5=function(){kM.apply(this,arguments)},mnE=function(){kM.apply(this,arguments)},BZE=function(){kM.apply(this,
arguments)},bbF=function(){kM.apply(this,arguments)},PXL=function(){kM.apply(this,arguments)},MGc=function(){kM.apply(this,arguments)},CXE=function(){kM.apply(this,arguments)},GkZ=function(h){h=h.key||h.id;
if(!h)throw Error("Entity key is missing");return h},LiZ=function(){if(pI)return pI();
var h={};pI=g.jn("PersistentEntityStoreDb",{uS:(h.EntityStore={PM:1},h.EntityAssociationStore={PM:2},h),shared:!1,upgrade:function(e,t){t(1)&&g.bq(g.$J(e,"EntityStore",{keyPath:"key"}),"entityType","entityType");t(2)&&(e=g.$J(e,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.bq(e,"byParentEntityKey","parentEntityKey"),g.bq(e,"byChildEntityKey","childEntityKey"))},
version:3});return pI()},a4T=function(h){return g.sZ(LiZ(),h)},vaS=function(h){return g.sZ((0,g.m0R)(),h)},$M=function(h){this.token=h},KI=function(h,e){e=e===void 0?{}:e;
g.eh.call(this,g.BHE[h],Object.assign({},{name:"PESEncoderError",type:h},e));this.type=h;this.level="WARNING";Object.setPrototypeOf(this,KI.prototype)},sgL=function(h){return new KI("WRONG_DATA_TYPE",{zz:h})},hLF=function(h){return h instanceof Error?new KI("UNKNOWN_ENCODE_ERROR",{St:h.message}):new KI("UNKNOWN_ENCODE_ERROR")},oR5=function(h){return h instanceof Error?new KI("UNKNOWN_DECODE_ERROR",{St:h.message}):new KI("UNKNOWN_DECODE_ERROR")},eLE=function(h,e){h=h instanceof KI?h:e(h);
g.B5(h);throw h;},tgE=function(){},QgZ=function(h,e,t){try{return h.N(e,t)}catch(Q){eLE(Q,hLF)}},N$L=function(h){h=(new TextEncoder).encode(h).subarray(0,16);
var e=new Uint8Array(16);e.set(h);return e},Hm=function(h){this.D=h},VgZ=function(h){var e=fMn[h];
if(e)return e;g.bQ(new g.eh("Entity model not found.",{entityType:h}))},yTS=function(h,e){this.D=h;
this.K=e;this.N={}},RL5=function(h,e){a:{h=jgE(h.K,e.version);
try{var t=h.K(e.data,e.key);break a}catch(Q){eLE(Q,oR5)}t=void 0}return t},Ef=function(h,e,t){return h.D.objectStore("EntityStore").get(e).then(function(Q){if(Q){if(t&&Q.entityType!==t)throw Error("Incorrect entity type");
return RL5(h,Q)}})},mH=function(h,e,t){return t?(t=t.map(function(Q){return Ef(h,Q,e)}),g.Fu.all(t)):h.D.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(e)).then(function(Q){return Q.map(function(N){return RL5(h,N)})})},bC=function(h,e,t){var Q=GkZ(e),N=jgE(h.K,1),f=Object.assign({},e);
return h.D.objectStore("EntityStore").get(Q).then(function(V){if(V){if(V.entityType!==t)throw Error("Incorrect entity type");f.entityMetadata||(V=RL5(h,V),f.entityMetadata=V.entityMetadata)}}).then(function(){var V={key:Q,
entityType:t,data:QgZ(N,f,Q),version:1};return g.Fu.all([g.Eb(h.D.objectStore("EntityStore"),V),uyZ(h,f,t)])}).then(function(){Bm(h,Q,t);
return Q})},UGE=function(h,e,t){e=e.map(function(Q){return bC(h,Q,t)});
return g.Fu.all(e)},Pm=function(h,e,t){if(t==null?0:t.hX){var Q=new Set;
return qNF(h,e,Q).then(function(){for(var f=[],V=g.c(Q),R=V.next();!R.done;R=V.next())f.push(Pm(h,R.value));return g.Fu.all(f).then(function(){})})}var N=g.AJ(e).entityType;
return g.Fu.all([h.D.objectStore("EntityStore").delete(e),rTT(h,e)]).then(function(){Bm(h,e,N)})},ATF=function(h,e){return g.Gt(h.D.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(e)},function(t){return g.Fu.all([t.delete(),
rTT(h,t.cursor.primaryKey)]).then(function(){Bm(h,t.cursor.primaryKey,e);return g.Mw(t)})})},zLF=function(h,e,t,Q){var N=jgE(h.K,1);
return Ef(h,e,Q).then(function(f){if(f){f=g.T_(f,t);var V={key:e,entityType:Q,data:QgZ(N,f,e),version:1};return g.Fu.all([g.Eb(h.D.objectStore("EntityStore"),V),uyZ(h,f,Q)])}}).then(function(){Bm(h,e,Q);
return e})},Bm=function(h,e,t){var Q=h.N[t];
Q||(Q=new Set,h.N[t]=Q);Q.add(e)},SNH=function(h,e,t){var Q=GkZ(e);
t=VgZ(t);if(!t)return g.Fu.resolve([]);t=new t(e);h=h.D.objectStore("EntityAssociationStore");e=[];t=g.c(t.K());for(var N=t.next();!N.done;N=t.next())e.push(g.Eb(h,{parentEntityKey:Q,childEntityKey:N.value}));return g.Fu.all(e).then(function(f){return f.map(function(V){return V[1]})})},rTT=function(h,e){return h.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(e))},uyZ=function(h,e,t){var Q=GkZ(e);
return rTT(h,Q).then(function(){return SNH(h,e,t)})},qNF=function(h,e,t){if(t.has(e))return g.Fu.resolve(void 0);
t.add(e);return JTH(h,e).then(function(Q){return h.D.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(e)).then(function(){return Q})}).then(function(Q){var N=g.Fu.resolve(void 0);
Q=g.c(Q);for(var f=Q.next(),V={};!f.done;V={u9:void 0},f=Q.next())V.u9=f.value,N=N.then(function(R){return function(){return qNF(h,R.u9,t)}}(V));
return N}).then(function(){})},JTH=function(h,e){var t=h.D.objectStore("EntityAssociationStore");
return t.index("byParentEntityKey").getAll(IDBKeyRange.only(e)).then(function(Q){var N=[];Q=g.c(Q);for(var f=Q.next();!f.done;f=Q.next())f=f.value,N.push(t.index("byChildEntityKey").getAll(f.childEntityKey));return g.Fu.all(N)}).then(function(Q){var N=[];
Q=g.c(Q);for(var f=Q.next();!f.done;f=Q.next())f=f.value,f.length===1&&N.push(f[0].childEntityKey);return N})},Mt=function(){},cTS=function(){this.D={};
this.D[0]=new Mt;if(!g.X8("aes_pes_encoder_killswitch")){var h=this.D;try{var e=g.tw();var t=N$L(e);var Q=new Hm(new g.FR(t),new g.ZR(t))}catch(N){throw h=N instanceof Error?new KI("KEY_CREATION_FAILED",{St:N.message}):new KI("KEY_CREATION_FAILED"),g.B5(h),h;}h[1]=Q}},jgE=function(h,e){e=e===void 0?0:e;
h=h.D[e];if(!h)throw e=new KI("INVALID_ENCODER_VERSION",{zz:e}),g.B5(e),e;return h},CI=function(h,e){g.K.call(this);
this.token=h;this.D=e;this.observers=[];h=new g.$P.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.tw());h.onmessage=this.K.bind(this);this.channel=h},G3=function(h,e,t){var Q,N,f,V;
return g.Y(function(R){if(R.D==1)return g.Z(R,a4T(h.token),2);if(R.D!=3)return Q=R.K,g.Z(R,g.HG(Q,["EntityStore","EntityAssociationStore"],e,function(u){N=new yTS(u,h.D);return t(N)}),3);
f=R.K;N&&(V=N.N,Object.keys(V).length>0&&(h.channel.postMessage(V),IMS(h,V)));return R.return(f)})},LI=function(h,e,t){return G3(h,{mode:"readwrite",
sE:!0},function(Q){return bC(Q,e,t)})},lMZ=function(h,e){return G3(h,{mode:"readwrite",
sE:!0},function(t){return UGE(t,e,"offlineOrchestrationActionWrapperEntity")})},iSt=function(h,e){return G3(h,{mode:"readwrite",
sE:!0},function(t){return Pm(t,e)})},xGT=function(h){return G3(h,{mode:"readwrite",
sE:!0},function(e){return ATF(e,"videoPlaybackPositionEntity")})},ar=function(h,e,t){return G3(h,{mode:"readonly",
sE:!0},function(Q){return Ef(Q,e,t)})},vm=function(h,e,t){return G3(h,{mode:"readonly",
sE:!0},function(Q){return mH(Q,e,t)})},IMS=function(h,e){h=g.c(h.observers);
for(var t=h.next();!t.done;t=h.next())t=t.value,t(e)},WYE=function(){var h,e,t;
return g.Y(function(Q){if(Q.D==1)return g.Ik(Q,2),g.Z(Q,g.Vk(),4);if(Q.D!=2){h=Q.K;if(!h||!g.Qp()||typeof g.$P.BroadcastChannel==="undefined")return Q.return();e=new cTS;return Q.return(new CI(h,e))}t=g.xP(Q);t instanceof Error&&g.B5(t);return Q.return()})},s1=function(){T$9||(T$9=WYE());
return T$9},OSL=function(h){var e;
h=(e=h.options)==null?void 0:e.persistenceOption;return h==="ENTITY_PERSISTENCE_OPTION_PERSIST"||h==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},gR9=function(h){var e;
return g.Y(function(t){return t.D==1?g.Z(t,s1(),2):(e=t.K)?g.Z(t,G3(e,"readwrite",function(Q){for(var N={},f=g.c(h),V=f.next(),R={};!V.done;R={YY:void 0,aC:void 0},V=f.next())R.YY=V.value,R.YY.entityKey&&OSL(R.YY)&&(R.aC=g.wx(R.YY.payload),V=void 0,R.YY.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(V=function(u){return function(){return bC(Q,u.YY.payload[u.aC],u.aC)}}(R)),R.YY.type==="ENTITY_MUTATION_TYPE_DELETE"&&(V=function(u){return function(){return Pm(Q,u.YY.entityKey)}}(R)),R.YY.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(V=function(u){return function(){return zLF(Q,u.YY.entityKey,u.YY.payload[u.aC],u.aC)}}(R)),V&&(N[R.YY.entityKey]=N[R.YY.entityKey]?N[R.YY.entityKey].then(V):V()));
return g.Fu.all(Object.values(N))}),0):t.return()})},dG5=function(h){var e;
return g.Y(function(t){if(t.D==1){e=h.mutations;if(!e||e.length<=0)return t.return();if(g.Ve){var Q={type:"ENTITY_LOADED"};e!==void 0&&(Q.payload=e);g.Ve.dispatch(Q)}return g.Z(t,gR9(e),2)}e.length=0;g.cB(t)})},w09=function(h){return h!==void 0},X05=function(h){var e=g.nD();
e=Object.assign({},e);h=Object.assign({},h);for(var t in e)h[t]?(e[t]!==4&&(e[t]=h[t]),delete h[t]):e[t]!==2&&(e[t]=4);Object.assign(e,h);g.QjB(e);JSON.stringify(e);return e},ZS9=function(h){var e,t;
return g.Y(function(Q){if(Q.D==1)return g.Z(Q,g.Vk(),2);if(Q.D!=3)return(e=Q.K)?g.Z(Q,g.pD(e),3):Q.return();t=Q.K;return Q.return(g.HG(t,["index","media","captions"],{mode:"readwrite",sE:!0},function(N){var f=IDBKeyRange.bound(h+"|",h+"~");N=[N.objectStore("index").delete(f),N.objectStore("media").delete(f),N.objectStore("captions").delete(f)];return g.Fu.all(N).then(function(){})}))})},FYE=function(){var h,e;
return g.Y(function(t){if(t.D==1)return g.Z(t,g.Vk(),2);if(t.D!=3){h=t.K;if(!h)throw g.Xu("rvdfd");return g.Z(t,g.pD(h),3)}e=t.K;return t.return(g.HG(e,["index","media"],{mode:"readwrite",sE:!0},function(Q){var N={};return g.PG(Q.objectStore("index"),{},function(f){var V=f.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),R=g.Fu.resolve(void 0);if(V){var u=V[1];V=V[2];N[u]=N[u]||{};var U;N[u][V]=g.jjL((U=f.getValue())==null?void 0:U.fmts)}else R=f.delete().then(function(){});
return g.Fu.all([g.Mw(f),R]).then(function(q){return g.c(q).next().value})}).then(function(){for(var f={},V=g.c(Object.keys(N)),R=V.next();!R.done;R=V.next()){R=R.value;
var u=N[R].v;f[R]=N[R].a&&u?1:2}var U=X05(f);return g.$Hv(Q.objectStore("media"),{},function(q){var r=q.cursor.key.match(g.qB$);r&&f[r[1]]||Q.objectStore("media").delete(q.cursor.key);return g.w_f(q)}).then(function(){return U})})}))})},YNF=function(h,e){var t,Q;
return g.Y(function(N){if(N.D==1)return g.Z(N,g.Vk(),2);if(N.D!=3){t=N.K;if(!t)throw g.Xu("wct");return g.Z(N,g.pD(t),3)}Q=N.K;return g.Z(N,g.HG(Q,["captions"],{mode:"readwrite",sE:!0},function(f){var V=[];f=f.objectStore("captions");for(var R=0;R<e.length;R++){var u=g.Eb(f,e[R],h+"|"+e[R].metadata.vss_id);V.push(u)}return g.Fu.all(V)}),0)})},nR5=function(h){var e,t,Q;
return g.Y(function(N){if(N.D==1)return e=IDBKeyRange.bound(h+"|",h+"~"),g.Z(N,g.Vk(),2);if(N.D!=3){t=N.K;if(!t)throw g.Xu("gactfv");return g.Z(N,g.pD(t),3)}Q=N.K;return N.return(Q.getAll("captions",e))})},DGc=function(h){return g.Y(function(e){g.kY(h,0);
return e.return(ZS9(h))})},kyZ=function(h){return{context:g.NA(),
videoIds:h}},p09=function(h){return{context:g.NA(),
playlistIds:h}},$Gn=function(h){return{context:g.NA(),
offlinePlaylistSyncChecks:h}},KYH=function(){this.D=new Map},ERc=function(){HSE||(HSE=new KYH);
return HSE},mGF=function(h,e){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:h},metadata:e,statusCode:void 0,csn:void 0,can:void 0}},B$H=function(h,e,t){if(!t){var Q=Q===void 0?!1:Q;
t=h.D.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!t||Q)t=g.Yh(16),h.D.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",t)}h={flowNonce:t,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:e.eventType};e.metadata&&(h.flowMetadata=e.metadata);e.statusCode!==void 0&&(h.flowEventStatus=e.statusCode);e.csn&&(h.csn=e.csn);e.can&&(h.can=e.can);g.Jw("flowEvent",h,void 0)},bSc=function(h){var e,t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At,T,d,X;
return g.Y(function(n){if(n.D==1)return g.Z(n,G3(h,{mode:"readonly",sE:!0},function(p){return mH(p,"playbackData").then(function(h$){var Q5=h$.map(function(zP){return zP.transfer}).filter(function(zP){return!!zP}),NX=h$.map(function(zP){return zP.offlineVideoPolicy}).filter(function(zP){return!!zP}),D=h$.filter(function(zP){return!!zP.key}).map(function(zP){return g.z2(g.AJ(zP.key).entityId,"downloadStatusEntity")});
Q5=mH(p,"transfer",Q5);NX=mH(p,"offlineVideoPolicy",NX);D=mH(p,"downloadStatusEntity",D);var Rk=Q5.then(function(zP){zP=zP.reduce(function(y5,Xx){(Xx==null?0:Xx.offlineVideoStreams)&&y5.push.apply(y5,g.x(Xx.offlineVideoStreams));return y5},[]).filter(function(y5){return!!y5});
return mH(p,"offlineVideoStreams",zP)});
return g.Fu.all([Q5,NX,Rk,D]).then(function(zP){var y5=g.c(zP);zP=y5.next().value;var Xx=y5.next().value;var qZ=y5.next().value;y5=y5.next().value;return[h$,zP,Xx,qZ,y5]})})}),2);
if(n.D!=3)return e=n.K,g.Z(n,G3(h,{mode:"readonly",sE:!0},function(p){return mH(p,"mainDownloadsListEntity").then(function(h$){var Q5,NX;return(NX=(Q5=h$[0])==null?void 0:Q5.downloads)!=null?NX:[]})}),3);
t=n.K;Q=g.c(e);N=Q.next().value;f=Q.next().value;V=Q.next().value;R=Q.next().value;u=Q.next().value;U=N;q=f;r=V;A=R;z=u;S={};l={};W={};O={};w={};F=[];k=g.c(q);for(E=k.next();!E.done;E=k.next())(G=E.value)&&(S[G.key]=G);C=g.c(r);for(t$=C.next();!t$.done;t$=C.next())(fv=t$.value)&&(l[fv.key]=fv);sU=g.c(z);for(B=sU.next();!B.done;B=sU.next())(v=B.value)&&(W[v.key]=v);I=g.c(A);for(b=I.next();!b.done;b=I.next())(Kv=b.value)&&(O[Kv.key]=Kv);IE=g.c(t);for(UL=IE.next();!UL.done;UL=IE.next())OU=UL.value,Lv=
void 0,w[(Lv=OU.videoItem)!=null?Lv:""]=!0,OU.videoItem&&(At=QT=void 0,T=(At=(QT=g.AJ(OU.videoItem))==null?void 0:QT.entityId)!=null?At:"",F.push({externalVideoId:T}));d=U.filter(function(p){if(!p||!p.key||!p.offlineVideoPolicy)return!1;p=g.AJ(p.key).entityId;p=g.z2(p,"downloadStatusEntity");var h$;return!(p&&((h$=W[p])==null?void 0:h$.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
X=d.map(function(p){var h$=S[p.transfer],Q5=[];if(h$==null?0:h$.offlineVideoStreams)for(var NX=g.c(h$.offlineVideoStreams),D=NX.next();!D.done;D=NX.next())(D=O[D.value])&&Q5.push(D);NX=l[p.offlineVideoPolicy];D=w;var Rk=p==null?void 0:p.playerResponseTimestamp,zP=g.AJ(NX.key).entityId;p=g.z2(zP,"mainVideoEntity");if(NX.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var y5="OFFLINE_VIDEO_STATE_DISABLED";NX.expirationTimestamp&&Number(NX.expirationTimestamp)<Date.now()/1E3&&(y5="OFFLINE_VIDEO_STATE_EXPIRED")}else if(NX.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")y5="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(h$==null?void 0:h$.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":y5="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":y5="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":y5="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":y5="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":y5="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":y5="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:y5="OFFLINE_VIDEO_STATE_UNKNOWN"}if(y5==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(h$==null?void 0:h$.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":y5="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":y5="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":y5=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}zP={id:zP,videoState:y5};if(h$==null?0:h$.cotn)zP.cotn=h$.cotn;if(h$==null?0:h$.maximumDownloadQuality)zP.selectedVideoQuality=h$==null?void 0:h$.maximumDownloadQuality;if(h$==null?0:h$.lastProgressTimeMs)zP.lastProgressTimeMs=h$.lastProgressTimeMs;Rk&&(zP.playerResponseSavedTimeMs=String(Number(Rk)*1E3));h$=String;Rk=0;Q5=g.c(Q5);for(y5=Q5.next();!y5.done;y5=Q5.next())if(y5=y5.value,y5.streamsProgress){y5=g.c(y5.streamsProgress);for(var Xx=y5.next();!Xx.done;Xx=
y5.next()){var qZ=void 0;Rk+=Number((qZ=Xx.value.numBytesDownloaded)!=null?qZ:0)}}zP.downloadedBytes=h$(Rk);zP.selectedOfflineMode=D[p]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";NX.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(zP.offlinePlaybackDisabledReason=NX.offlinePlaybackDisabledReason);return zP});
return n.return({offlineVideos:X,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:F}}})})},P_t=function(){this.locks=navigator.locks},MgR=function(){try{var h=g.EU("ytglobal.locks_");
if(h)return h;var e;if(e=navigator){var t=navigator;e="locks"in t&&!!t.locks}if(e)return g.$P.localStorage&&g.$P.localStorage.getItem("noop"),h=new P_t,g.HB("ytglobal.locks_",h),h}catch(Q){}},hO=function(){},C_n=function(){},Gy5=function(h){if(h.includes(":"))throw Error("Invalid user cache name: "+h);
return h+":"+g.tw("CacheStorage get")},LYS=function(){return g.Y(function(h){if(oR!==void 0)return h.return(oR);
oR=new Promise(function(e){var t;return g.Y(function(Q){switch(Q.D){case 1:return g.Ik(Q,2),g.Z(Q,ec.open("test-only"),4);case 4:return g.Z(Q,ec.delete("test-only"),5);case 5:g.iL(Q,3);break;case 2:if(t=g.xP(Q),t instanceof Error&&t.name==="SecurityError")return e(!1),Q.return();case 3:e("caches"in window),g.cB(Q)}})});
return h.return(oR)})},vRL=function(){return g.Y(function(h){if(h.D==1)return g.Z(h,LYS(),2);
if(!h.K)return h.return(void 0);aMZ||(aMZ=new C_n);return h.return(aMZ)})},tO=function(h,e,t){g.bQ(new g.eh("Woffle: "+h,t?{cotn:t}:""));
e instanceof Error&&g.bQ(e)},smH=function(h){var e;
return g.Y(function(t){if(t.D==1)return g.Z(t,bSc(h),2);e=t.K;g.Jw("offlineStateSnapshot",e);g.cB(t)})},Qd=function(h){g.K.call(this);
var e=this;this.api=h;this.gL={FPa:function(){return e.D},
QBy:function(){return e.K}};
typeof g.$P.BroadcastChannel!=="undefined"&&(this.D=new g.$P.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.tw()),this.D.onmessage=this.N.bind(this),this.K=new g.$P.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.tw()),this.K.onmessage=this.B.bind(this))},Nh=function(h,e){h.api.hw("onOfflineOperationFailure",e);
var t;(t=h.D)==null||t.postMessage(e)},hif=function(h,e,t,Q){var N=this;
this.W=h;this.Y=e;this.visibility=t;this.L=Q;this.V=this.J=this.X=this.N=this.D=!1;this.B=new g.fF(function(){N.L5()});
this.gL={B9:function(){return N.K},
L5:function(){N.L5()},
jBw:function(){return N.B}};
this.visibility.subscribe("visibilitystatechange",function(){N.Xa()})},oBf=function(h){if(!h.N&&!h.D){var e=MgR();
if(e){h.N=!0;var t=g.tw("OfflineLockManager");e.request("woffle_orchestration_leader:"+t,{},function(){var Q,N,f,V;return g.Y(function(R){switch(R.D){case 1:return g.Ik(R,2),h.K=new g.WJ,h.D=!0,h.N=!1,g.Z(R,h.W(),4);case 4:return g.Z(R,h.K.promise,5);case 5:g.iL(R,0);break;case 2:Q=g.xP(R),((f=(N=h).L)==null?0:f.call(N,"wo_relinquish_leadership_on_lock_request_error"))||h.L5(),Q instanceof Error&&(V=Q,V.args=[{name:"WoLockManagerError",Cp:Q.name}],g.B5(V)),g.cB(R)}})})}}},ei5=function(h){h.D&&(h.V=
!0,fl(h))},tCE=function(h,e){h.D&&(h.X=e,fl(h))},QmR=function(h,e){h.D&&(h.J=e,fl(h))},fl=function(h){h.J&&h.X&&h.V&&h.visibility.isBackground()?g.V8(h.B,6E4):h.B.stop()},Vd=function(h){var e;
h.offlineDeleteReason=(e=h.offlineDeleteReason)!=null?e:"OFFLINE_DELETE_REASON_UNKNOWN";var t;h.offlineModeType=(t=h.offlineModeType)!=null?t:"OFFLINE_NOW";g.Jw("offlineDeleteEvent",h)},yd=function(h,e){var t=e.videoId;
var Q=e.jI;e=e.offlineModeType;h.encryptedVideoId=t;h.cotn=Q==null?void 0:Q.cotn;h.offlineabilityFormatType=Q==null?void 0:Q.maximumDownloadQuality;var N;h.isRefresh=(N=Q==null?void 0:Q.isRefresh)!=null?N:!1;var f;h.softErrorCount=(f=Q==null?void 0:Q.transferRetryCount)!=null?f:0;h.offlineModeType=e!=null?e:"OFFLINE_NOW";(h.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&h.statusType==="UNKNOWN_STATUS_TYPE"||!h.transferStatusType&&!h.statusType)&&g.bQ(Error("Woffle unknown transfer status"));
g.Jw("offlineTransferStatusChanged",h)},NYS=function(h,e,t,Q){Q={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!Q};e&&t&&(e=Math.floor(e/1024).toFixed(),t=Math.floor(t/1024).toFixed(),Q.alreadyDownloadedKbytes=e,Q.totalFetchedKbytes=e,Q.totalContentKbytes=t);yd(Q,h)},f1c=function(h){yd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},h)},VCS=function(h){switch(h){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
jc=function(h){var e,t,Q;
return((Q=(e=h.actionMetadata)==null?void 0:(t=e.retryScheduleIntervalsInSeconds)==null?void 0:t.length)!=null?Q:0)>0},RR=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!h.entityKey},u$=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!h.entityKey},U1=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!h.entityKey},y3f=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!h.entityKey},
qh=function(h,e,t,Q,N){N=N===void 0?!1:N;
var f,V,R,u,U,q;return g.Y(function(r){if(r.D==1)return f=g.z2(h,e),V=g.z2(h,"downloadStatusEntity"),g.Z(r,G3(t,{mode:"readonly",sE:!0},function(A){return g.Fu.all([Ef(A,f,e),Ef(A,V,"downloadStatusEntity")])}),2);
R=r.K;u=R.length?R[0]:void 0;if(!u)return r.Ty(0);U=jmE;if(q=R.length>1?R[1]:void 0){if(q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!N)return r.return();q.downloadState=Q}else q={key:V,downloadState:Q};g.Ln(u,U,q);return g.Z(r,G3(t,{mode:"readwrite",sE:!0},function(A){return g.Fu.all([bC(A,u,e),bC(A,q,"downloadStatusEntity")])}),0)})},rc=function(h,e){return h.actionType===e.actionType&&h.entityKey===e.entityKey},AO=function(h,e){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!==
"TRANSFER_STATE_FAILED"){var t=g.AJ(h.key).entityId;
yd({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:t,jI:h,offlineModeType:e})}},zp=function(h){if(!h||!h.thumbnails)return[];
var e=[];h=g.c(h.thumbnails);for(var t=h.next();!t.done;t=h.next())t=t.value,t.url&&e.push(t.url);return e},RiZ=function(h,e,t){t=t===void 0?[]:t;
var Q,N,f,V,R,u,U,q,r,A,z,S,l;return g.Y(function(W){if(W.D==1)return t.length?g.Z(W,vm(h,e),2):W.return([]);Q=W.K;N=new Set;f=g.c(Q);for(V=f.next();!V.done;V=f.next())if(R=V.value,u=R.id||R.key)U=g.AJ(u).entityId,N.add(U);q=[];r=g.c(t);for(A=r.next();!A.done;A=r.next())z=A.value,S=z.offlineVideoData,l=void 0,((l=S)==null?0:l.videoId)&&!N.has(S.videoId)&&q.push(z);return W.return(q)})},u$f=function(h,e,t){return new g.LD(h,{cotn:e,
raw_player_response:t,download_media:!0,start:Infinity,disable_watch_next:!0})},UgS=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Sc=function(h,e,t,Q,N,f,V,R,u,U,q){this.entityType=h;
this.actionId=e;this.action=t;this.parentActionId=Q;this.rootActionId=N===void 0?e:N;this.childActionIds=f;this.prereqActionId=V;this.postreqActionIds=R;this.hasChildActionFailed=U;this.retryScheduleIndex=0;this.D=q||Date.now();this.retryScheduleIndex=u||0},JO=function(h){if(!h.key)throw Error("Entity key is required.");
if(!h.actionProto)throw Error("OfflineOrchestrationAction is required.");var e=g.AJ(h.key),t=g.AJ(h.actionProto.entityKey);return new Sc(t.entityType,e.entityId,h.actionProto,h.parentActionId,h.rootActionId,h.childActionIds,h.prereqActionId,h.postreqActionIds,h.retryScheduleIndex,h.hasChildActionFailed,Number(h.enqueueTimeSec)*1E3)},ch=function(h){return{key:g.z2(h.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:h.action,parentActionId:h.parentActionId,rootActionId:h.rootActionId,childActionIds:h.childActionIds,prereqActionId:h.prereqActionId,postreqActionIds:h.postreqActionIds,retryScheduleIndex:h.retryScheduleIndex,hasChildActionFailed:h.hasChildActionFailed,enqueueTimeSec:(h.D/1E3).toFixed()}},qMR=function(){var h;
return g.Y(function(e){return e.D==1?g.Z(e,vRL(),2):(h=e.K)?e.return(h.delete("yt-player-local-img")):e.return(!0)})},IR=function(h){var e,t;
return g.Y(function(Q){if(Q.D==1)return g.Z(Q,vRL(),2);if(Q.D!=3){e=Q.K;if(!e)throw Error("Cache API not supported");return h.length?g.Z(Q,e.open("yt-player-local-img"),3):Q.return()}t=Q.K;return g.Z(Q,Promise.all(h.map(function(N){return t.delete(N)})),0)})},l$=function(h){var e,t;
return g.Y(function(Q){if(Q.D==1)return g.Z(Q,vRL(),2);if(Q.D!=3){e=Q.K;if(!e)throw Error("Cache API not supported");return h.length?g.Z(Q,e.open("yt-player-local-img"),3):Q.return()}t=Q.K;return g.Z(Q,t.addAll(h),0)})},i$=function(h,e,t,Q,N){var f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv;
return g.Y(function(QT){switch(QT.D){case 1:return f=g.z2(h,"mainVideoEntity"),V=g.z2(h,"ytMainChannelEntity"),R=g.z2(h,"transfer"),u=g.z2(h,"videoDownloadContextEntity"),g.Z(QT,G3(e,{mode:"readonly",sE:!0},function(At){return g.Fu.all([Ef(At,f,"mainVideoEntity"),Ef(At,V,"ytMainChannelEntity"),Ef(At,R,"transfer"),Ef(At,u,"videoDownloadContextEntity"),mH(At,"ytMainChannelEntity"),mH(At,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:U=QT.K;q=g.c(U);r=q.next().value;A=q.next().value;z=q.next().value;S=q.next().value;l=q.next().value;W=q.next().value;O=r;w=A;F=z;k=S;E=l;G=W;if(!O&&!w){QT.Ty(3);break}C=O?zp(O.thumbnail):[];if(!w){t$=[];QT.Ty(4);break}return g.Z(QT,r3F(w,E),5);case 5:t$=QT.K;case 4:return fv=t$,g.Z(QT,IR(C.concat(fv)),3);case 3:sU=[];B=g.z2(h,"downloadStatusEntity");v=g.c(G);for(I=v.next();!I.done;I=v.next())b=I.value,Kv=g.AJ(b.key).entityId,IE=JO(b),UL=g.AJ(IE.action.entityKey).entityId,Kv!==h&&UL!==h||rc(t,
b.actionProto)||sU.push(b.key);return g.Z(QT,G3(e,{mode:"readwrite",sE:!0},function(At){var T=sU.map(function(d){return Pm(At,d)});
T.push(Pm(At,f,{hX:!0}));T.push(Pm(At,B,{hX:!0}));return g.Fu.all(T)}),7);
case 7:Lv=(OU=k)==null?void 0:OU.offlineModeType,N&&(Vd(N),N.offlineModeType&&(Lv=N.offlineModeType)),AO(F,Lv),Nh(Q,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.cB(QT)}})},SMc=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At,T,d,X,n,p,h$,Q5,NX,D,Rk,zP,y5,Xx,qZ,p5,Ux;
return g.Y(function(BB){switch(BB.D){case 1:return N=g.z2(h,"mainPlaylistEntity"),f=g.z2(h,"ytMainChannelEntity"),g.Z(BB,G3(e,{mode:"readonly",sE:!0},function($l){return g.Fu.all([Ef($l,N,"mainPlaylistEntity"),Ef($l,f,"ytMainChannelEntity"),mH($l,"mainPlaylistEntity"),mH($l,"mainDownloadsListEntity"),mH($l,"ytMainChannelEntity"),mH($l,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:V=BB.K;R=g.c(V);u=R.next().value;U=R.next().value;q=R.next().value;r=R.next().value;A=R.next().value;z=R.next().value;S=u;l=U;W=q;O=r;w=A;F=z;if(!S&&!l){BB.Ty(3);break}k=S?A3T(S):[];if(!l){E=[];BB.Ty(4);break}return g.Z(BB,r3F(l,w),5);case 5:E=BB.K;case 4:return G=E,g.Z(BB,IR(k.concat(G)),3);case 3:C=[];t$=new Map;if(!S){BB.Ty(7);break}return g.Z(BB,ziE(S,W,O),8);case 8:C=BB.K;fv=g.c(C);for(sU=fv.next();!sU.done;sU=fv.next())B=sU.value,t$.set(B,{videoId:B,playlistId:h,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.Z(BB,G3(e,{mode:"readonly",sE:!0},function($l){return g.Fu.all([mH($l,"transfer"),mH($l,"videoDownloadContextEntity")])}),9);
case 9:v=BB.K;I=g.c(v);b=I.next().value;Kv=I.next().value;IE=b;UL=Kv;OU=g.c(IE);for(Lv=OU.next();!Lv.done;Lv=OU.next())QT=Lv.value,At=g.AJ(QT.key).entityId,(T=t$.get(At))&&QT&&(T.cotn=QT.cotn);d=g.c(UL);for(X=d.next();!X.done;X=d.next())n=X.value,p=g.AJ(n.key).entityId,(h$=t$.get(p))&&n&&(h$.offlineModeType=n.offlineModeType);case 7:Q5=[];NX=g.c(F);for(D=NX.next();!D.done;D=NX.next())Rk=D.value,zP=g.AJ(Rk.key).entityId,y5=JO(Rk),zP!==h&&y5.rootActionId!==h||rc(t,Rk.actionProto)||Q5.push(Rk.key);Xx=
g.z2(h,"mainPlaylistEntity");return g.Z(BB,G3(e,{mode:"readwrite",sE:!0},function($l){var yL=Q5.map(function(FF){return Pm($l,FF)});
yL.push(Pm($l,Xx,{hX:!0}));return g.Fu.all(yL)}),10);
case 10:if(!S){BB.Ty(0);break}C.reverse();if(!C){BB.Ty(0);break}qZ=g.c(C);p5=qZ.next();case 13:if(p5.done){BB.Ty(0);break}Ux=p5.value;return g.Z(BB,i$(Ux,e,t,Q,t$.get(Ux)),14);case 14:p5=qZ.next(),BB.Ty(13)}})},c3E=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A;
return g.Y(function(z){if(z.D==1)return N=g.z2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),f=new Map,g.Z(z,G3(h,{mode:"readwrite",sE:!0},function(S){var l=mH(S,"transfer"),W=mH(S,"offlineOrchestrationActionWrapperEntity"),O=mH(S,"videoDownloadContextEntity"),w=Ef(S,N,"mainDownloadsListEntity");return g.Fu.all([l,W,O,w]).then(function(F){F=g.c(F);var k=F.next().value;var E=F.next().value;var G=F.next().value;var C=F.next().value;F=J3t.map(function(fv){return ATF(S,fv)});
E=g.c(E);for(var t$=E.next();!t$.done;t$=E.next())t$=t$.value,rc(e,t$.actionProto)||F.push(Pm(S,t$.key,{hX:!0}));C&&(C.downloads=[],F.push(bC(S,C,"mainDownloadsListEntity")));if(G)for(G=g.c(G),C=G.next();!C.done;C=G.next())C=C.value,E=g.AJ(C.key).entityId,E=g.z2(E,"transfer"),f.set(E,C.offlineModeType);return g.Fu.all(F).then(function(){return k})})}),2);
V=z.K;R=g.c(V);for(u=R.next();!u.done;u=R.next())U=u.value,AO(U,f.get(U.key)),q=g.AJ(U.key).entityId,r={videoId:q,offlineDeleteReason:Q,cotn:U.cotn,offlineModeType:f.get(U.key)},Vd(r),A=g.z2(q,"mainVideoEntity"),Nh(t,{entityKey:A,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Z(z,qMR(),0)})},A3T=function(h,e){var t=[];
if(h.thumbnailStyleData){h=g.c(h.thumbnailStyleData);for(var Q=h.next();!Q.done;Q=h.next()){var N=void 0,f=void 0,V=void 0;t=t.concat(zp((N=Q.value)==null?void 0:(f=N.value)==null?void 0:(V=f.collageThumbnail)==null?void 0:V.coverThumbnail))}}e=zp(e);return t.concat(e)},ziE=function(h,e,t){var Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv;
return g.Y(function(sU){Q=[];N=new Set;if(t.length)for(f=g.c(t),V=f.next();!V.done;V=f.next())if(R=V.value,u=void 0,(u=R.downloads)==null?0:u.length)for(U=g.c(R.downloads),q=U.next();!q.done;q=U.next())r=q.value,r.videoItem&&(A=g.AJ(r.videoItem).entityId,N.add(A));if(h.videos){z=g.c(h.videos);for(S=z.next();!S.done;S=z.next())l=S.value,W=JSON.parse(g.AJ(l).entityId),W.videoId&&!N.has(W.videoId)&&Q.push(W.videoId);O=g.c(e);for(w=O.next();!w.done;w=O.next())if(F=w.value,F.key!==h.key&&(k=F.videos))for(E=
g.c(k),G=E.next();!G.done;G=E.next())C=G.value,t$=JSON.parse(g.AJ(C).entityId),t$.videoId&&(fv=Q.indexOf(t$.videoId),fv!==-1&&Q.splice(fv,1))}return sU.return(Q)})},r3F=function(h,e){var t,Q,N,f,V,R,u,U;
return g.Y(function(q){t=zp(h.avatar);Q=g.c(e);for(N=Q.next();!N.done;N=Q.next())if(f=N.value,f.id!==h.id)for(V=g.c(zp(f.avatar)),R=V.next();!R.done;R=V.next())u=R.value,U=t.indexOf(u),U!==-1&&t.splice(U,1);return q.return(t)})},I1t=function(h){var e;
return g.Y(function(t){e=g.m(h.frameworkUpdates,xd);return h.frameworkUpdates&&e?g.Z(t,dG5(e),0):t.return()})},iMH=function(h){var e;
if((e=h.onResponseReceivedActions)!=null&&e.length){var t;h=(t=g.m(g.m(h.onResponseReceivedActions[0],l1S),g.$xE))==null?void 0:t.actions;if(h!=null&&h.length)return h}},xgF=function(h){var e,t,Q;
return g.Y(function(N){if(N.D==1)return h?g.Z(N,ar(h,g.nN,"mainDownloadsListEntity"),2):N.return([]);e=N.K;return((t=e)==null?0:(Q=t.downloads)==null?0:Q.length)?N.return(e.downloads.map(function(f){var V;return(V=f.videoItem)!=null?V:""})):N.return([])})},TYt=function(h,e){var t;
return g.Y(function(Q){return Q.D==1?g.Z(Q,WNZ(h,e),2):(t=Q.K)?g.Z(Q,G3(h,{mode:"readwrite",sE:!0},function(N){var f=[bC(N,t.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];t.mainDownloadsListEntity&&f.push(bC(N,t.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Fu.all(f)}),0):Q.Ty(0)})},WNZ=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F;
return g.Y(function(k){if(k.D==1)return t=g.z2("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.z2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Z(k,G3(h,{mode:"readonly",sE:!0},function(E){return g.Fu.all([Ef(E,t,"mainDownloadsLibraryEntity"),Ef(E,Q,"mainDownloadsListEntity")])}),2);
N=k.K;f=g.c(N);V=f.next().value;R=f.next().value;u=V;U=R;u||(u={id:t});q=g.c(e);for(r=q.next();!r.done;r=q.next())if(A=r.value,A===g.nN){if(u.smartDownloadsList)return k.return();u.smartDownloadsList=A}else if(z=g.AJ(A).entityType,S={},z==="mainPlaylistEntity"?S.playlistItem=A:z==="mainVideoEntity"&&(S.videoItem=A),!g.Dr(S)){l=void 0;if((l=U)==null?0:l.downloads){W=!1;O=g.c(U.downloads);for(w=O.next();!w.done;w=O.next())if(F=w.value,F.playlistItem===A||F.videoItem===A){W=!0;break}W||U.downloads.push(S)}else U=
{id:Q,downloads:[S]};u.downloadsList=Q}return k.return({mainDownloadsLibraryEntity:u,mainDownloadsListEntity:U})})},OMT=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W;
return g.Y(function(O){if(O.D==1)return t=g.z2("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.z2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Z(O,G3(h,{mode:"readonly",sE:!0},function(w){return g.Fu.all([Ef(w,t,"mainDownloadsLibraryEntity"),Ef(w,Q,"mainDownloadsListEntity"),Ef(w,g.nN,"mainDownloadsListEntity")])}),2);
N=O.K;f=g.c(N);V=f.next().value;R=f.next().value;u=f.next().value;U=V;q=R;r=u;if(!U)return O.Ty(0);if(e===g.nN&&((A=r)==null?0:A.downloads))r.downloads=[];else if((z=q)==null?0:z.downloads)for(S=g.AJ(e).entityType,l=0;l<q.downloads.length;l++)if(W=q.downloads[l],S==="mainVideoEntity"&&W.videoItem===e){q.downloads.splice(l,1);break}else if(S==="mainPlaylistEntity"&&W.playlistItem===e){q.downloads.splice(l,1);break}return g.Z(O,G3(h,{mode:"readwrite",sE:!0},function(w){var F=[bC(w,U,"mainDownloadsLibraryEntity")];
q&&F.push(bC(w,q,"mainDownloadsListEntity"));r&&F.push(bC(w,r,"mainDownloadsListEntity"));return g.Fu.all(F)}),0)})},Wh=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A;
return g.Y(function(z){if(z.D==1)return t=g.z2(e,"transfer"),Q=g.z2(e,"videoDownloadContextEntity"),g.Z(z,G3(h,{mode:"readonly",sE:!0},function(S){return g.Fu.all([Ef(S,t,"transfer"),Ef(S,Q,"videoDownloadContextEntity")])}),2);
N=z.K;f=g.c(N);V=f.next().value;R=f.next().value;u=V;U=R;A={videoId:e,cotn:(q=u)==null?void 0:q.cotn,offlineModeType:(r=U)==null?void 0:r.offlineModeType};return z.return(A)})},Tp=function(h,e,t,Q,N){var f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$;
return g.Y(function(fv){switch(fv.D){case 1:return f=g.z2(h,"musicTrack"),V=g.z2(h,"transfer"),g.Z(fv,G3(e,{mode:"readonly",sE:!0},function(sU){return g.Fu.all([Ef(sU,f,"musicTrack"),Ef(sU,V,"transfer"),mH(sU,"musicTrack"),mH(sU,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=fv.K;u=g.c(R);U=u.next().value;q=u.next().value;r=u.next().value;A=u.next().value;z=U;S=q;l=r;W=A;if(!z){fv.Ty(3);break}return g.Z(fv,gBf(z,l),4);case 4:return O=fv.K,g.Z(fv,IR(O),3);case 3:w=[];F=g.c(W);for(k=F.next();!k.done;k=F.next())E=k.value,G=g.AJ(E.key).entityId,C=JO(E),t$=g.AJ(C.action.entityKey).entityId,G!==h&&t$!==h||rc(t,E.actionProto)||w.push(E.key);return g.Z(fv,G3(e,{mode:"readwrite",sE:!0},function(sU){var B=w.map(function(v){return Pm(sU,v)});
B.push(Pm(sU,f,{hX:!0}));return g.Fu.all(B)}),6);
case 6:AO(S),N&&Vd(N),Nh(Q,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.cB(fv)}})},O1=function(h,e,t,Q,N){var f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At,T,d,X;
return g.Y(function(n){switch(n.D){case 1:return f=g.z2(h,e),V=g.z2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Z(n,G3(t,{mode:"readonly",sE:!0},function(p){return g.Fu.all([Ef(p,f,e),Ef(p,V,"musicDownloadsLibraryEntity"),mH(p,e),mH(p,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:R=n.K;u=g.c(R);U=u.next().value;q=u.next().value;r=u.next().value;A=u.next().value;z=U;S=q;l=r;W=A;if(!z){n.Ty(3);break}return g.Z(n,gBf(z,l),4);case 4:return O=n.K,g.Z(n,IR(O),3);case 3:w=[];F=new Map;if(!z){n.Ty(6);break}return g.Z(n,dgL(z,l,S),7);case 7:w=n.K;k=g.c(w);for(E=k.next();!E.done;E=k.next())G=E.value,C=g.AJ(G).entityId,F.set(C,{videoId:C,playlistId:h,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.Z(n,vm(t,"transfer"),8);case 8:for(t$=n.K,fv=g.c(t$),
sU=fv.next();!sU.done;sU=fv.next())B=sU.value,v=g.AJ(B.key).entityId,(I=F.get(v))&&B&&(I.cotn=B.cotn);case 6:b=[];Kv=g.c(W);for(IE=Kv.next();!IE.done;IE=Kv.next())UL=IE.value,OU=g.AJ(UL.key).entityId,Lv=JO(UL),OU!==h&&Lv.rootActionId!==h||rc(Q,UL.actionProto)||b.push(UL.key);QT=g.z2(h,e);return g.Z(n,G3(t,{mode:"readwrite",sE:!0},function(p){var h$=b.map(function(Q5){return Pm(p,Q5)});
h$.push(Pm(p,QT,{hX:!0}));return g.Fu.all(h$)}),9);
case 9:if(!z){n.Ty(0);break}w.reverse();if(!w.length){n.Ty(0);break}At=g.c(w);T=At.next();case 12:if(T.done){n.Ty(0);break}d=T.value;X=g.AJ(d).entityId;if(!X){n.Ty(13);break}return g.Z(n,Tp(X,t,Q,N,F.get(X)),13);case 13:T=At.next(),n.Ty(12)}})},gc=function(h,e,t){var Q,N,f,V,R,u,U;
return g.Y(function(q){if(q.D==1)return g.Z(q,G3(h,{mode:"readwrite",sE:!0},function(r){var A=mH(r,"transfer"),z=mH(r,"offlineOrchestrationActionWrapperEntity");return g.Fu.all([A,z]).then(function(S){S=g.c(S);var l=S.next().value;var W=S.next().value;S=wzf.map(function(k){return ATF(r,k)});
W=g.c(W);for(var O=W.next();!O.done;O=W.next()){O=O.value;var w=g.AJ(O.actionProto.entityKey).entityType==="musicTrack",F=O.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";rc(e,O.actionProto)||w&&(!w||F)||S.push(Pm(r,O.key,{hX:!0}))}return g.Fu.all(S).then(function(){return l})})}),2);
Q=q.K;N=g.c(Q);for(f=N.next();!f.done;f=N.next())V=f.value,AO(V),R=g.AJ(V.key).entityId,u={videoId:R,offlineDeleteReason:void 0,cotn:V.cotn},Vd(u),U=g.z2(R,"musicTrack"),Nh(t,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Z(q,qMR(),0)})},XzE=function(h){for(var e,t=g.c(h.additionalMetadatas),Q=t.next();!Q.done;Q=t.next())Q=Q.value,Q.offlineMusicVideoData&&(e=Q.offlineMusicVideoData);
var N,f,V,R,u;return{id:g.z2(h.videoId,"musicTrack"),videoId:h.videoId,title:h.title,thumbnailDetails:h.thumbnail,lengthMs:String(Number(h.lengthSeconds)*1E3),albumTitle:(N=e)==null?void 0:N.releaseTitle,musicVideoType:(f=e)==null?void 0:f.musicVideoType,contentRating:{explicitType:(V=e)==null?void 0:V.explicitType},artistNames:((R=e)==null?void 0:R.byline)||((u=e)==null?void 0:u.channelName),downloadMetadata:g.z2(h.videoId,"musicTrackDownloadMetadataEntity")}},dgL=function(h,e,t){var Q,N,f,V,R,u,
U,q,r,A,z,S,l,W,O,w,F,k;
return g.Y(function(E){Q=[];N=new Set;if((f=t)==null?0:(V=f.downloadedTracks)==null?0:V.length)for(R=g.c(t.downloadedTracks),u=R.next();!u.done;u=R.next())U=u.value,N.add(U);if(h.tracks){q=g.c(h.tracks);for(r=q.next();!r.done;r=q.next())A=r.value,N.has(A)||Q.push(A);z=g.c(e);for(S=z.next();!S.done;S=z.next())if(l=S.value,l.id!==h.id&&(W=l.tracks))for(O=g.c(W),w=O.next();!w.done;w=O.next())F=w.value,k=Q.indexOf(F),k!==-1&&Q.splice(k,1)}return E.return(Q)})},gBf=function(h,e){var t,Q,N,f,V,R,u,U;
return g.Y(function(q){t=zp(h.thumbnailDetails);Q=g.c(e);for(N=Q.next();!N.done;N=Q.next())if(f=N.value,f.id!==h.id)for(V=g.c(zp(f.thumbnailDetails)),R=V.next();!R.done;R=V.next())u=R.value,U=t.indexOf(u),U!==-1&&t.splice(U,1);return q.return(t)})},ZMT=function(h,e){var t,Q,N,f,V,R,u,U,q;
return g.Y(function(r){if(r.D==1)return t=g.z2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Z(r,ar(h,t,"musicDownloadsLibraryEntity"),2);(Q=r.K)||(Q={id:t});N=g.AJ(e).entityType;N==="musicTrack"?(f=Q.downloadedTracks)!=null&&f.includes(e)||(Q.downloadedTracks=((V=Q.downloadedTracks)!=null?V:[]).concat(e)):N==="musicPlaylist"?(R=Q.downloadedPlaylists)!=null&&R.includes(e)||(Q.downloadedPlaylists=((u=Q.downloadedPlaylists)!=null?u:[]).concat(e)):N!=="musicAlbumRelease"||(U=Q.downloadedAlbumReleases)!=
null&&U.includes(e)||(Q.downloadedAlbumReleases=((q=Q.downloadedAlbumReleases)!=null?q:[]).concat(e));return g.Z(r,LI(h,Q,"musicDownloadsLibraryEntity"),0)})},FNH=function(h,e){var t,Q,N,f,V,R,u;
return g.Y(function(U){if(U.D==1)return t=g.z2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Z(U,ar(h,t,"musicDownloadsLibraryEntity"),2);Q=U.K;if(!Q)return U.Ty(0);N=g.AJ(e).entityType;N==="musicTrack"?f=Q.downloadedTracks:N==="musicPlaylist"&&(f=Q.downloadedPlaylists);if((V=f)==null?0:V.length)for(R=0;R<f.length;R++)if(u=f[R],u===e){f.splice(R,1);break}return g.Z(U,LI(h,Q,"musicDownloadsLibraryEntity"),0)})},YMH=function(h){var e=h.videos;
h=[];var t=[];if(e){e=g.c(e);for(var Q=e.next();!Q.done;Q=e.next()){var N=Q.value.offlineVideoData.videoId;Q=g.z2(N,"musicTrack");N=g.z2(N,"musicTrackDownloadMetadataEntity");h.push(Q);t.push(N)}}return{Hv:h,FJ:t}},dc=function(h,e,t){e={track:XzE(e)};
t&&(e.playlistId=t);if(h=g.m(h.actionMetadata,nBE))e.maximumDownloadQuality=h.maximumDownloadQuality;return{musicTrackEntityActionMetadata:e}},kLE=function(h){var e,t,Q,N,f,V,R,u;
return g.Y(function(U){switch(U.D){case 1:return e=g.rj(),t=kyZ(h),Q=g.yA(DgE),g.Ik(U,2),f={z6:!0},g.Z(U,g.QK(e,t,Q,void 0,f),4);case 4:N=U.K;g.iL(U,3);break;case 2:V=g.xP(U);if(V instanceof g.oV)throw R="GetOffline network manager error: "+V.message,tO(R,V),Error(R);tO("GetOffline fetch request error",V);throw Error("GetOffline fetch request error");case 3:u=wc(N);if(!N)throw tO("Network request failed"),Error("Network request failed");if(u!==void 0)Xp(u);else if(!N.videos||!N.videos.length)throw tO("No data"),
Error("No data");return U.return(N.videos.map(function(q){return q.offlineVideoData}))}})},pzE=function(h){var e,t,Q,N,f,V,R,u;
return g.Y(function(U){switch(U.D){case 1:return e=g.rj(),t=p09(h),Q=g.yA(DgE),g.Ik(U,2),f={z6:!0},g.Z(U,g.QK(e,t,Q,void 0,f),4);case 4:N=U.K;g.iL(U,3);break;case 2:V=g.xP(U);if(V instanceof g.oV)throw R="GetOffline network manager error for playlist: "+V.message,tO(R,V),Error(R);tO("GetOffline fetch request error for playlist",V);throw Error("GetOffline fetch request error for playlist");case 3:u=wc(N);if(!N)throw tO("Network request failed for playlist"),Error("Network request failed for playlist");
if(u!==void 0)Xp(u,"playlist");else if(!N.playlists||!N.playlists.length)throw tO("No data for playlist"),Error("No data for playlist");return U.return(N.playlists.map(function(q){return q.offlinePlaylistData}))}})},KN5=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL;
return g.Y(function(OU){switch(OU.D){case 1:return g.Z(OU,s1(),2);case 2:N=OU.K;if(!N)return OU.return([]);f=[];if((V=Q)==null?0:V.length){f=Q;OU.Ty(3);break}return g.Z(OU,vm(N,"mainPlaylistEntity"),4);case 4:f=OU.K;case 3:if(!f.length)return OU.return([]);R=[];u=Date.now()/1E3;U=g.c(f);q=U.next();case 5:if(q.done)return R.length?g.Z(OU,$gE(R),10):OU.return([]);r=q.value;if(!r.downloadState){A=void 0;OU.Ty(8);break}return g.Z(OU,ar(N,r.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:A=
OU.K;case 8:z=A;S=void 0;W=(l=(S=r)==null?void 0:S.entityMetadata)&&l.nextAutoRefreshIntervalSeconds?Number(l.nextAutoRefreshIntervalSeconds):NaN;O=Number.isNaN(W)?h:W;F=w=void 0;k=((w=z)==null?0:w.lastSyncedTimestampMillis)?Number((F=z)==null?void 0:F.lastSyncedTimestampMillis)/1E3:0;G=E=void 0;C=((E=z)==null?0:E.addedTimestampMillis)?Number((G=z)==null?void 0:G.addedTimestampMillis)/1E3:0;if(t||!l||k+O<=u){t$=[];fv=void 0;if((fv=r.videos)==null?0:fv.length)for(sU=g.c(r.videos),B=sU.next();!B.done;B=
sU.next())v=B.value,I=JSON.parse(g.AJ(v).entityId),I.videoId&&t$.push(I.videoId);b="0";l&&(Kv=void 0,b=String(Number((Kv=l.offlineLastModifiedTimestampSeconds)!=null?Kv:0).toFixed()));IE={playlistId:r.playlistId,videoIds:t$,offlineLastModifiedTimestamp:b,autoSync:e,offlineDateAddedTimestamp:String(C.toFixed())};R.push(IE)}q=U.next();OU.Ty(5);break;case 10:return UL=OU.K,OU.return(UL)}})},HM5=function(){var h,e,t,Q,N;
return g.Y(function(f){if(f.D==1)return g.Z(f,s1(),2);if(f.D!=3)return(h=f.K)?g.Z(f,vm(h,"refresh"),3):f.return(!1);e=f.K;if((t=e[0])==null||!t.refreshTime)return f.return(!1);Q=Number(e[0].refreshTime);N=Date.now()/1E3;return f.return(isFinite(Q)&&N>=Q)})},mgE=function(h,e){var t,Q,N;
return g.Y(function(f){switch(f.D){case 1:return g.Ik(f,2),g.Z(f,EBE(h,e),4);case 4:return Q=f.K,g.Z(f,I1t(Q),5);case 5:t=iMH(Q);g.iL(f,3);break;case 2:N=g.xP(f),tO("getAndProcessSmartDownloadsResponse request or processing error",N);case 3:return f.return(t)}})},BYZ=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL;
return g.Y(function(OU){switch(OU.D){case 1:return g.Z(OU,s1(),2);case 2:N=OU.K;if(!N)return OU.return([]);f=[];if((V=Q)==null?0:V.length){f=Q;OU.Ty(3);break}return g.Z(OU,vm(N,"musicPlaylist"),4);case 4:f=OU.K;case 3:if(!f.length)return OU.return([]);R=[];u=Date.now()/1E3;U=g.c(f);q=U.next();case 5:if(q.done)return R.length?g.Z(OU,$gE(R),10):OU.return([]);r=q.value;A=void 0;S=(z=(A=r)==null?void 0:A.entityMetadata)&&z.nextAutoRefreshIntervalSeconds?Number(z.nextAutoRefreshIntervalSeconds):NaN;l=
Number.isNaN(S)?h:S;O=W=0;w="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!r.downloadMetadata){OU.Ty(8);break}return g.Z(OU,ar(N,r.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:F=OU.K,E=k=void 0,W=Number((E=(k=F)==null?void 0:k.addedTimestampMillis)!=null?E:"0")/1E3,C=G=void 0,O=Number((C=(G=F)==null?void 0:G.lastModifiedTimestampMillis)!=null?C:"0")/1E3,fv=t$=void 0,w=(fv=(t$=F)==null?void 0:t$.syncState)!=null?fv:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:sU=void 0;if(t||w!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!z||Number((sU=z.lastSyncedTimestampSeconds)!=null?sU:0)+l<=u){B=[];v=void 0;if((v=r.tracks)==null?0:v.length)for(I=g.c(r.tracks),b=I.next();!b.done;b=I.next())Kv=b.value,B.push(g.AJ(Kv).entityId);IE={playlistId:r.playlistId,videoIds:B,offlineLastModifiedTimestamp:String(O.toFixed()),autoSync:e,offlineDateAddedTimestamp:String(W.toFixed())};R.push(IE)}q=U.next();OU.Ty(5);break;case 10:return UL=OU.K,OU.return(UL)}})},EBE=function(h,e){var t,Q,N,f,V,R,u,U,q,r;
return g.Y(function(A){switch(A.D){case 1:return t=g.rj(),g.Z(A,s1(),2);case 2:Q=A.K;if(!Q){A.Ty(3);break}return g.Z(A,bSc(Q),4);case 4:N=A.K;case 3:var z=N;f={context:g.NA(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:h},offlineClientState:z,clientStateRequestData:{preferredFormatType:e}}}};V=g.yA(bMf);g.Ik(A,5);u={z6:!0};return g.Z(A,g.QK(t,f,V,void 0,u),7);case 7:R=A.K;g.iL(A,6);break;case 5:U=g.xP(A);if(U instanceof g.oV)throw q=
"DPS network manager error for smart downloads: "+U.message,tO(q,U),Error(q);tO("DPS fetch request error for smart downloads",U);throw Error("DPS fetch request error for smart downloads");case 6:r=wc(R);if(R)r!==void 0&&Xp(r,"smart downloads");else throw tO("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return A.return(R)}})},MC9=function(h,e){var t,Q,N,f,V,R,u,U;
return g.Y(function(q){switch(q.D){case 1:return t=g.rj(),Q={context:g.NA(),videoPlaybackPositionEntities:h,lastSyncTimestampUsec:e},N=g.yA(PgH),g.Ik(q,2),V={z6:!0},g.Z(q,g.QK(t,Q,N,void 0,V),4);case 4:f=q.K;g.iL(q,3);break;case 2:R=g.xP(q);if(R instanceof g.oV)throw u="VPPS network manager error: "+R.message,tO(u,R),Error(u);tO("VPPS fetch request error",R);throw Error("VPPS fetch request error");case 3:U=wc(f);if(f)U!==void 0&&Xp(U,"position sync");else throw tO("Network request failed for position sync"),
Error("Network request failed for position sync");return q.return(f)}})},GL5=function(h,e,t){var Q,N,f,V,R,u,U,q;
return g.Y(function(r){switch(r.D){case 1:Q=g.rj();var A=t.refreshData,z=t.isEnqueuedForExpiredStreamUrlRefetch,S=t.e3,l=t.offlineSourceData,W=t.mediaCapabilities,O={entityKey:h};A&&(O.refreshData=A);z&&(O.isExpiredStreamUrlRefetch=z);S&&(O.downloadParameters=S);l&&(O.offlineSourceData=l);A={context:g.R_(e),signatureTimestamp:20157,videos:[O]};W&&(A.mediaCapabilities=W);N=A;f=g.yA(Cg5);g.Ik(r,2);R={z6:!0};return g.Z(r,g.QK(Q,N,f,void 0,R),4);case 4:V=r.K;g.iL(r,3);break;case 2:u=g.xP(r);if(u instanceof
g.oV)throw U="GetPDE network manager error: "+u.message,tO(U,u),Error(U);tO("GetPDE fetch request error",u);throw Error("GetPDE fetch request error");case 3:q=wc(V);if(V)q!==void 0&&Xp(q,"PDE");else throw tO("Network request failed for PDE"),Error("Network request failed for PDE");return r.return(V)}})},wc=function(h){var e;
return(e=h.errorMetadata)==null?void 0:e.status},Xp=function(h,e){e=e?" for "+e:"";
if(h===0)throw h="Empty response body"+e,tO(h),Error(h);h="Response with error"+e;tO(h);throw Error(h);},$gE=function(h){var e,t,Q,N,f,V,R,u;
return g.Y(function(U){switch(U.D){case 1:return e=g.rj(),t=$Gn(h),Q=g.yA(LNE),g.Ik(U,2),f={z6:!0},g.Z(U,g.QK(e,t,Q,void 0,f),4);case 4:N=U.K;g.iL(U,3);break;case 2:V=g.xP(U);if(V instanceof g.oV)throw R="offlinePlaylistSyncCheck network manager error: "+V.message,tO(R,V),Error(R);tO("offlinePlaylistSyncCheck fetch request error",V);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:u=wc(N);if(!N)throw tO("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(u!==void 0)Xp(u,"playlist sync");else if(!N.offlinePlaylistSyncCheckDatas||!N.offlinePlaylistSyncCheckDatas.length)throw tO("No data for playlist sync"),Error("No data for playlist sync");return U.return(N.offlinePlaylistSyncCheckDatas.map(function(q){return q.offlinePlaylistSyncCheckData}))}})},ZC=function(h){this.D=h},a1Z=function(h,e){var t,Q,N,f,V,R;
return g.Y(function(u){switch(u.D){case 1:t=new Map,Q=g.c(e),N=Q.next();case 2:if(N.done){u.Ty(4);break}f=N.value;V=t;R=V.set;return g.Z(u,h.K(f),5);case 5:R.call(V,f,u.K);N=Q.next();u.Ty(2);break;case 4:return u.return(t)}})},Fp=function(h,e,t,Q,N,f){e=g.z2(e,t);
Q=Object.assign({},f,{priority:Q,retryScheduleIntervalsInSeconds:N});return{actionType:h,entityKey:e,actionMetadata:Q}},Yd=function(h,e,t,Q,N,f){this.status=h;
this.D=e;this.B=t;this.K=Q;this.N=N;this.downloadState=f},vBS=function(h,e,t){this.D=h;
this.O$=e;this.N=t},o0t=function(h,e){var t,Q,N,f,V,R,u,U,q;
return g.Y(function(r){switch(r.D){case 1:return t=e.entityKey,N=(Q=g.m(e.actionMetadata,nl))==null?void 0:Q.isEnqueuedForExpiredStreamUrlRefetch,g.Ik(r,2),f=void 0,g.Z(r,sfS(h,e),4);case 4:f=r.K;g.Ik(r,5);var A=(A=g.m(e.actionMetadata,nl))?{maximumDownloadQuality:A.maximumDownloadQuality}:void 0;return g.Z(r,GL5(t,h.O$,{isEnqueuedForExpiredStreamUrlRefetch:N,e3:A,offlineSourceData:f}),7);case 7:V=r.K;g.iL(r,6,2);break;case 5:return g.xP(r,2),R=jc(e)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",tO("PDE handleAdd error"),r.return(DC(e,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",R,"DOWNLOAD_STATE_FAILED"));case 6:return g.Z(r,hh9(h,V,e),8);case 8:return r.return(DC(e,!0,V.orchestrationActions));case 2:return u=g.xP(r),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.Tt&&u.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tO("PDE handleAdd error"),r.return(DC(e,!1,void 0,U,q,"DOWNLOAD_STATE_FAILED"))}})},Qfn=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv;
return g.Y(function(sU){switch(sU.D){case 1:return t=e.entityKey,Q=g.AJ(t).entityId,g.Z(sU,G3(h.D,{mode:"readonly",sE:!0},function(B){var v=Ef(B,t,"playbackData"),I=Ef(B,g.z2(Q,"offlineVideoPolicy"),"offlineVideoPolicy");B=Ef(B,g.z2(Q,"transfer"),"transfer");return g.Fu.all([v,I,B])}),2);
case 2:N=sU.K;f=g.c(N);V=f.next().value;R=f.next().value;u=f.next().value;U=V;q=R;r=u;if(!U||!q)return sU.return(DC(e,!0));A=[];l=((S=U)==null?0:S.playerResponseJson)?JSON.parse(U.playerResponseJson):null;if(!(r&&l&&h.O$.L("html5_refresh_deprecated_downloads"))){sU.Ty(3);break}z=ehZ(h,l,r);return g.Z(sU,txT(h,r),4);case 4:A=sU.K;case 3:W={lastPlayerResponseTimestampSeconds:U.playerResponseTimestamp,offlineToken:q.offlineToken,formatIds:A};O={};if((w=r)==null?0:w.maximumDownloadQuality)O.maximumDownloadQuality=
r.maximumDownloadQuality;g.Ik(sU,5);F=void 0;return g.Z(sU,sfS(h,e),7);case 7:return F=sU.K,g.Ik(sU,8),g.Z(sU,GL5(t,h.O$,{refreshData:W,e3:O,offlineSourceData:F,mediaCapabilities:z}),10);case 10:k=sU.K;g.iL(sU,9,5);break;case 8:return g.xP(sU,5),E=jc(e)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",tO("PDE handleRefresh error"),sU.return(DC(e,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,
"DOWNLOAD_STATE_FAILED"));case 9:return g.Z(sU,hh9(h,k,e),11);case 11:return sU.return(DC(e,!0,k.orchestrationActions));case 5:return G=g.xP(sU),C="PDE handleRefresh error",G instanceof Error&&(C="PDE handleRefresh error: "+G.message),t$="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",fv="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.Tt&&G.type==="QUOTA_EXCEEDED"&&(t$="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",fv="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
tO(C),sU.return(DC(e,!1,void 0,t$,fv,"DOWNLOAD_STATE_FAILED"))}})},sfS=function(h,e){var t,Q,N,f;
return g.Y(function(V){if(V.D==1)return t=g.AJ(e.entityKey).entityId,Q=g.z2(t,"videoDownloadContextEntity"),g.Z(V,ar(h.D,Q,"videoDownloadContextEntity"),2);N=V.K;return(f=N)!=null&&f.offlineModeType?V.return({offlineModeType:N.offlineModeType}):V.return(void 0)})},hh9=function(h,e,t){var Q,N,f,V,R;
return g.Y(function(u){if(u.D==1){if(!e.frameworkUpdates||!g.m(e.frameworkUpdates,xd))return u.return();if(!(g.m(e.frameworkUpdates,xd).mutations&&g.m(e.frameworkUpdates,xd).mutations.length>0&&g.m(e.frameworkUpdates,xd).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return u.Ty(2);Q=g.AJ(g.m(e.frameworkUpdates,xd).mutations[0].entityKey).entityId;return g.Z(u,Wh(h.D,Q),3)}if(u.D!=2){N=u.K;f=g.m(t.actionMetadata,nl);if(R=(V=f)==null?void 0:V.playlistId)N.playlistId=R;N.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.e9(h.O$)?g.Z(u,i$(Q,h.D,t,h.N,N),2):g.Py(h.O$)?g.Z(u,Tp(Q,h.D,t,h.N),2):u.Ty(2)}return g.Z(u,dG5(g.m(e.frameworkUpdates,xd)),0)})},DC=function(h,e,t,Q,N,f){return new Yd(e?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",jc(h),t,Q,N,f)},ehZ=function(h,e,t){e=u$f(h.O$,t.cotn,e);
t=g.qa(e);return g.pdU(e,t,h.O$)},txT=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A;
return g.Y(function(z){if(z.D==1)return t=[],g.Z(z,G3(h.D,{mode:"readonly",sE:!0},function(S){var l=[],W=e.offlineVideoStreams;if(W){W=g.c(W);for(var O=W.next();!O.done;O=W.next())l.push(Ef(S,O.value,"offlineVideoStreams"))}return g.Fu.all(l)}),2);
if(Q=z.K)for(N=g.c(Q),f=N.next();!f.done;f=N.next())if(V=f.value,R=void 0,(R=V)==null?0:R.streamsProgress)for(u=V.streamsProgress,U=0;U<u.length;U++)q=u[U],r=JSON.parse(q.formatStreamBytes),A={itag:r.itag,lmt:r.lastModified,xtags:r.xtags},t.push(A);return z.return(t)})},NAS=function(h,e){this.D=h;
this.O$=e},f_H=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z;
return g.Y(function(S){switch(S.D){case 1:return t=jc(e),g.Z(S,vm(h.D,"videoPlaybackPositionEntity"),2);case 2:Q=S.K;if(Q.length===0)return S.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Ik(S,3);return g.Z(S,$M.getInstance(),5);case 5:N=S.K;if(!N)throw Error("prefStorage is undefined");return g.Z(S,N.get("psi"),6);case 6:return f=S.K,u=(R=(V=f)==null?void 0:V.BZ)!=null?R:"0",g.Z(S,MC9(Q,u),7);case 7:return U=S.K,q={isPaused:U.watchHistoryPaused,BZ:U.syncTimestampUsec},g.Z(S,N.set("psi",
q),8);case 8:if(q.isPaused){S.Ty(9);break}r=g.m(U.frameworkUpdates,xd);if(!U.frameworkUpdates||!r){S.Ty(9);break}return g.Z(S,dG5(r),9);case 9:g.iL(S,4);break;case 3:return A=g.xP(S),z="PPE handleRefresh error: "+(A instanceof Error?A.message:"unknown error"),tO(z),S.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return S.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},yZE=function(h,e){var t,Q,N,f,V,R,u,U;
return g.Y(function(q){switch(q.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey).entityId,g.Ik(q,2),g.Z(q,$M.getInstance(),4);case 4:N=q.K;if(!N)throw Error("prefStorage is undefined");return g.Z(q,N.get("psi"),5);case 5:f=q.K;V=g.m(e.actionMetadata,Vx9);if(((R=f)==null?void 0:R.isPaused)!==!1||(u=V)==null||!u.lastPlaybackPositionSeconds){q.Ty(6);break}U={key:g.z2(Q,"videoPlaybackPositionEntity"),videoId:Q,lastPlaybackPositionSeconds:V.lastPlaybackPositionSeconds};return g.Z(q,LI(h.D,U,"videoPlaybackPositionEntity"),
6);case 6:g.iL(q,3);break;case 2:return g.xP(q),q.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},jfL=function(h,e){var t,Q,N;
return g.Y(function(f){switch(f.D){case 1:t=jc(e);g.Ik(f,2);Q=g.AJ(e.entityKey).entityId;if(Q==="!*$_ALL_ENTITIES_!*$")return g.Z(f,xGT(h.D),5);N=g.z2(Q,"videoPlaybackPositionEntity");return g.Z(f,iSt(h.D,N),5);case 5:g.iL(f,3);break;case 2:return g.xP(f),f.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},RhR=function(h,e){this.api=h;
this.D=e;this.logger=new g.Rc("woffle");this.K=!1;this.gL={Pp:this.Pp};this.logger.debug("Initialized OfflineMediaManager")},uMF=function(h){return g.Y(function(e){return e.return(DGc(h))})},UdE=function(h){var e;
return g.Y(function(t){if(t.D==1)return g.Z(t,g.Ry$(h),2);e=t.K;return t.return(e.filter(function(Q){return!!Q.url}).map(function(Q){return Q.url}))})},kd=function(h,e){var t=g.Dm(e);
if(t===1||t===0)return Promise.resolve();(t=qrL(h,e))&&t.stopVideo();h.N=0;return uMF(e)},pl=function(h,e,t,Q){t=t===void 0?!1:t;
Q=Q===void 0?!0:Q;var N=typeof e==="string"?e:e.videoDetails.videoId;g.Dm(N)===2&&((e=qrL(h,N))?e.stopVideo():h.logger.info(function(){return"Corresponding player for "+N+" not found. Pausing anyway"}),g.kY(N,2),h.N=2,t?rZE(h.D):Q&&AZF(h.D))},qrL=function(h,e){var t;
return((t=h.player)==null?void 0:t.getVideoData().videoId)===e?h.player:null},zht=function(h,e,t){e.getPlayerResponse();
g.kY(e.videoId,2);h.N=2;h.K=!1;var Q;(Q=h.player)==null||Q.dispose();h.player=h.api.gJ(e);e={};h.player.T2((e.localmediachange=h.sS,e.signatureexpired=h.B1,e.statechange=h.d5$,e),h);var N=h.Pp(t);h.player.Wg(g.RK(N,N,!0,"m"),!1);h.logger.debug(function(){return"Starting headless playback with quality: "+N});
h.player.kT(!1)},Src=function(h,e){this.D=h;
this.O$=e},cZc=function(h,e){var t,Q;
return g.Y(function(N){switch(N.D){case 1:return t=jc(e),g.Z(N,ar(h.D,e.entityKey,"transfer"),2);case 2:if(Q=N.K)return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Ik(N,3);return g.Z(N,JZf(h,e),5);case 5:g.iL(N,4);break;case 3:return g.xP(N),N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},I_L=function(h,e){var t,Q;
return g.Y(function(N){switch(N.D){case 1:return t=jc(e),g.Z(N,ar(h.D,e.entityKey,"transfer"),2);case 2:Q=N.K;if(!Q||Q.transferState!=="TRANSFER_STATE_COMPLETE")return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Ik(N,3);return g.Z(N,JZf(h,e,!0),5);case 5:g.iL(N,4);break;case 3:return g.xP(N),N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},l_F=function(h,e){var t,Q,N,f,V,R,u,U,q,r;
return g.Y(function(A){switch(A.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey).entityId,g.Z(A,G3(h.D,{mode:"readonly",sE:!0},function(z){var S=Ef(z,e.entityKey,"transfer");z=Ef(z,g.z2(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Fu.all([S,z])}),2);
case 2:N=A.K;f=g.c(N);V=f.next().value;R=f.next().value;u=V;U=R;if(!u||u.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return A.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Ik(A,3);u.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.Z(A,LI(h.D,u,"transfer"),5);case 5:q=g.AJ(u.key).entityId;yd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:q,jI:u,offlineModeType:(r=U)==null?void 0:r.offlineModeType});g.iL(A,
4);break;case 3:return g.xP(A),A.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return A.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},JZf=function(h,e,t){t=t===void 0?!1:t;
var Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O;return g.Y(function(w){switch(w.D){case 1:return Q=g.m(e.actionMetadata,iGT),N=g.AJ(e.entityKey).entityId,f=g.z2(N,"downloadStatusEntity"),g.Z(w,G3(h.D,{mode:"readonly",sE:!0},function(F){var k=Ef(F,f,"downloadStatusEntity");F=Ef(F,g.z2(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Fu.all([k,F])}),2);
case 2:return V=w.K,R=g.c(V),u=R.next().value,U=R.next().value,q=u,r=U,A="TRANSFER_STATE_TRANSFER_IN_QUEUE",((z=q)==null?void 0:z.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(A="TRANSFER_STATE_PAUSED_BY_USER"),W={key:e.entityKey,transferState:A,cotn:g.Yh(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(S=Q)==null?void 0:S.maximumDownloadQuality,preferredAudioTrack:(l=Q)==null?void 0:l.preferredAudioTrack,transferRetryCount:0,isRefresh:t,hasLoggedFirstStarted:!1},g.Z(w,G3(h.D,
{mode:"readwrite",sE:!0},function(F){var k=[];t&&k.push(Pm(F,g.z2(N,"offlineVideoStreams")));k.push(bC(F,W,"transfer"));return g.Fu.all(k)}),3);
case 3:if(!t){w.Ty(4);break}return g.Z(w,uMF(N),4);case 4:yd({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:N,jI:W,offlineModeType:(O=r)==null?void 0:O.offlineModeType}),g.cB(w)}})},WDE=function(h,e,t,Q){if(!h.action.entityKey)throw Error("entityKey is missing.");
var N=g.AJ(h.action.entityKey);N={entityType:N.Np,entityId:N.entityId,offlineOrchestrationActionType:h.action.actionType,orchestrationAction:{orchestrationActionId:h.actionId}};e&&(N.offlineOrchestrationActionResult=e.status,N.isRetryable=t?!1:e.D,e.N&&(N.offlineOrchestrationFailureReason=xdE(e.N,N.isRetryable)));var f,V;if((f=h.action.actionMetadata)==null?0:(V=f.offlineLoggingData)==null?0:V.offlineModeType)N.offlineModeType=h.action.actionMetadata.offlineLoggingData.offlineModeType;Q&&(N.additionalOrchestrationActions=
Q.map(function(R){return{orchestrationActionId:R.actionId}}));
return N},xdE=function(h,e){return h!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||e?h==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&e?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":h:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},TAn=function(h,e){var t={offlineOrchestrationContext:WDE(h)};
e=mGF(e,t);B$H(ERc(),e,h.rootActionId)},OGH=function(h,e,t,Q){Q=Q===void 0?[]:Q;
e={offlineOrchestrationContext:WDE(h,e,t,Q)};e=mGF(3,e);B$H(ERc(),e,h.rootActionId)},g0E=function(){this.actions=[]},ddc=function(h,e){e=g.c(e);
for(var t=e.next();!t.done;t=e.next())t=t.value,TAn(t,1),h.actions.push(t);h.actions.sort(h.D)},wUR=function(h,e){if(e)for(var t=0;t<h.actions.length;t++)if(e==="!*$_ALL_ENTITIES_!*$"&&h.actions[t].actionId!==e||e!=="!*$_ALL_ENTITIES_!*$"&&h.actions[t].rootActionId===e&&h.actions[t].actionId!==e)h.actions.splice(t,1),t--},XUc=function(h,e){h=g.c(h.actions);
for(var t=h.next();!t.done;t=h.next())if(t.value.actionId===e)return!0;return!1},$d=function(h,e,t,Q,N){g.K.call(this);
var f=this;this.K=h;this.gy=e;this.D$=t;this.J=Q;this.O$=N;this.D=new g0E;this.X=new g.Qz;this.N=new g.fF(function(){f.retry()});
this.W=NaN;this.V=!1;this.gL={k6$:function(){return f.D},
jR:function(){return f.X},
XTR:function(){return f.N},
retry:function(){return f.retry()}};
g.H(this,this.N);this.Y=this.K.observe(this.zy.bind(this))},Yrf=function(h,e,t,Q,N){var f;
return g.Y(function(V){if(V.D==1)return f=new $d(h,e,t,Q,N),g.Z(V,ZGF(f),2);FD9(f);return V.return(f)})},FD9=function(h){var e=h.D.actions[0];
return h.B?((e==null?void 0:e.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&h.B[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(h.V=!0),Promise.resolve()):n0H(h)},n0H=function(h){var e,t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O;
return g.Y(function(w){switch(w.D){case 1:if(h.B)throw Error("Already processing an action");if(h.VW())return w.return();e=h.D.actions.shift();tCE(h.D$,!e);if(e===void 0)return w.return();e.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&e.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&wUR(h.D,e.actionId);t="";e.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&e.rootActionId===e.actionId&&(t=e.actionId);Q=[e];h.B=Q;if(N=h.gy[e.entityType]){w.Ty(2);break}h.B=
void 0;return g.Z(w,n0H(h),3);case 3:return w.return();case 2:f=g.c(Q);for(V=f.next();!V.done;V=f.next())R=V.value,TAn(R,2);g.Ik(w,4,5);return g.Z(w,a1Z(N,Q.map(function(F){return F.action})),7);
case 7:u=w.K,U=g.c(Q),q=U.next();case 8:if(q.done){w.Ty(10);break}r=q.value;A=u.get(r.action);return g.Z(w,Ddc(h,r,A),9);case 9:q=U.next();w.Ty(8);break;case 10:wUR(h.D,t);case 5:g.WB(w);h.B=void 0;g.TP(w,6);break;case 4:return z=g.xP(w),tO("Orchestration error",z),g.Ik(w,12),g.Z(w,kxE(h,Q),14);case 14:g.iL(w,5);break;case 12:S=g.xP(w);tO("Orchestration retry error",S);l=g.c(Q);for(W=l.next();!W.done;W=l.next())O=W.value,O.retryScheduleIndex<3&&ddc(h.D,[O]);w.Ty(5);break;case 6:return g.Z(w,n0H(h),
0)}})},Ddc=function(h,e,t){var Q,N,f,V,R,u,U,q,r,A,z,S;
return g.Y(function(l){switch(l.D){case 1:Q=e.retryScheduleIndex+2===3;if(t.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){l.Ty(2);break}if(t.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){l.Ty(0);break}OGH(e,t,Q);if(t.D&&e.retryScheduleIndex+1<3)return g.Z(l,kxE(h,[e]),0);f=((N=t)==null?0:N.K)?t.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";V={entityKey:e.action.entityKey,failureReason:f};R=void 0;g.e9(h.O$)?R="mainVideoDownloadStateEntity":g.Py(h.O$)&&(R="musicTrackDownloadMetadataEntity");
if(!R||!t.downloadState){l.Ty(7);break}u=g.AJ(e.action.entityKey).entityId;return g.Z(l,qh(u,R,h.K,t.downloadState),7);case 7:Nh(h.J,V);if(t.downloadState==="DOWNLOAD_STATE_FAILED"&&h.O$.L("html5_auto_retry_failed_pde_actions")){l.Ty(0);break}tO("Orchestration result is not retryable, deleting action");return g.Z(l,iSt(h.K,ch(e).key),0);case 2:U=void 0;try{U=(q=t.B)==null?void 0:q.map(function(W){return h.createAction(W,e)})}catch(W){return OGH(e,t,Q),r={entityKey:e.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Nh(h.J,r),tO("Orchestration subactions creation error",W),l.return()}OGH(e,t,Q,U);if(!U){l.Ty(12);break}A=U.map(function(W){return ch(W)});
z=0;case 13:if(!(z<U.length)||h.V){l.Ty(15);break}return g.Z(l,G3(h.K,{mode:"readwrite",sE:!0},function(W){var O=[];O.push(UGE(W,A.slice(z,z+10),"offlineOrchestrationActionWrapperEntity"));return g.Fu.all(O)}),16);
case 16:z+=10;l.Ty(13);break;case 15:if(h.V)return h.V=!1,l.return();case 12:return S=ch(e),g.Z(l,iSt(h.K,S.key),17);case 17:TAn(e,4),g.cB(l)}})},HG5=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z;
return g.Y(function(S){t=[];Q=Infinity;N=4E3;f=g.c(e);for(V=f.next();!V.done;V=f.next())R=V.value,u=Number(R.enqueueTimeSec),U=pUT(u),q=R.retryScheduleIndex,r=q!=null&&q>0,U>0&&r?(Q=Math.min(Q,u),N=Math.min(U,N)):t.push(R);isFinite(Q)&&(!h.N.isActive()||Q<h.W)&&(h.W=Q,h.N.start(N));h.X.G4()||(A=t.length,t=t.filter(function(l){var W;l=((W=l.actionProto)==null?void 0:W.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!$dS.includes(l)}),z=t.length<A,!h.N.isActive()&&z&&h.N.start(1));
t.length>0&&KDn(h,t);return g.Z(S,FD9(h),0)})},mdL=function(h){var e,t,Q,N,f,V,R;
return g.Y(function(u){if(u.D==1)return g.Z(u,E0E(h),2);e=u.K;t=[];Q=g.c(e);for(N=Q.next();!N.done;N=Q.next())f=N.value,V=g.AJ(f.key),R=V.entityId,XUc(h.D,R)||t.push(f);return g.Z(u,HG5(h,t),0)})},pUT=function(h){h=h*1E3-Date.now();
return h>4E3?4E3:h},kxE=function(h,e){var t,Q,N;
return g.Y(function(f){t=g.c(e);for(Q=t.next();!Q.done;Q=t.next()){N=Q.value;var V=void 0,R=void 0,u=((R=N.action)==null?void 0:(V=R.actionMetadata)==null?void 0:V.retryScheduleIntervalsInSeconds)||[1,2,4];V=1;N.retryScheduleIndex<u.length&&(V=u[N.retryScheduleIndex]);N.D=V*1E3+Date.now();N.retryScheduleIndex++}return g.Z(f,BAZ(h,e),0)})},ZGF=function(h){var e;
return g.Y(function(t){if(t.D==1)return g.Z(t,vm(h.K,"offlineOrchestrationActionWrapperEntity"),2);e=t.K;return g.Z(t,HG5(h,e),0)})},KDn=function(h,e){e.length!==0&&e.forEach(function(t){t=JO(t);
t.retryScheduleIndex<3&&ddc(h.D,[t])})},E0E=function(h,e){var t;
return g.Y(function(Q){if(Q.D==1)return g.Z(Q,vm(h.K,"offlineOrchestrationActionWrapperEntity",e),2);t=Q.K;return Q.return(t.filter(w09))})},BAZ=function(h,e){if(e.length===0)return Promise.resolve([]);
e=e.map(function(t){return ch(t)});
return lMZ(h.K,e)},bGE=function(h){this.Gy=h;
this.D=void 0},Pxc=function(h,e){var t,Q,N,f;
return g.Y(function(V){t=e.videoId;Q=!0;if(e.captionTracks.length)N=j4F(e),h.D=new g.xo(h.Gy,e,N);else if(e.FA)f=g.cfk(e),h.D=new g.Tr(h.Gy,e.FA,t,f,e.V2,e.eventId),Q=e.V2;else return V.return();return V.return(new Promise(function(R){var u;(u=h.D)==null||u.q9({hd:function(){return g.Y(function(U){if(U.D==1)return g.Z(U,h.hd(t,Q),2);R();g.cB(U)})},
Qr:function(){}})}))})},Mxc=function(h){var e;
return g.Y(function(t){if(t.D==1)return g.Z(t,nR5(h),2);e=t.K;return t.return(!!e&&e.length>0)})},Kl=function(h){g.K.call(this);
this.D=h;this.K=this.D.observe(this.N.bind(this))},CxR=function(h,e){var t,Q,N,f,V,R,u;
return g.Y(function(U){switch(U.D){case 1:if(e.length===0)return U.return([]);t=e.map(function(q){return g.z2(q,"transfer")});
return g.Z(U,vm(h.D,"transfer",t),2);case 2:Q=U.K;N=Q.filter(w09).map(function(q){return g.AJ(q.key).entityId});
f=e.filter(function(q){return N.indexOf(q)===-1});
if(f.length===0)return U.return([]);V=g.c(f);R=V.next();case 3:if(R.done){U.Ty(5);break}u=R.value;return g.Z(U,uMF(u),4);case 4:R=V.next();U.Ty(3);break;case 5:return U.return(f)}})},a_T=function(h,e,t,Q,N,f){var V,R,u;
return g.Y(function(U){V="STREAM_TYPE_UNKNOWN";t.video&&t.audio?(V="STREAM_TYPE_AUDIO_AND_VIDEO",tO("unexpected stream type")):t.video&&!t.audio?V="STREAM_TYPE_VIDEO":!t.video&&t.audio&&(V="STREAM_TYPE_AUDIO");R=g.z2(e,"offlineVideoStreams");u={numBytesDownloaded:N.toFixed(),numTotalBytes:f.toFixed(),streamType:V,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(Q),itag:V==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(t.itag):void 0};return g.Z(U,G3(h,{mode:"readwrite",sE:!0},
function(q){var r=Ef(q,R,"offlineVideoStreams"),A=Ef(q,g.z2(e,"transfer"),"transfer");return g.Fu.all([r,A]).then(function(z){z=g.c(z);var S=z.next().value;z=z.next().value;if(!z)return Pm(q,R).then(function(){});
var l=Gx5(S);S=LDF(S,Q,u,R);var W=bC(q,S,"offlineVideoStreams");Gx5(S)>l&&(z.lastProgressTimeMs=Date.now().toString());l=[W];z.offlineVideoStreams||(z.offlineVideoStreams=[]);z.offlineVideoStreams.indexOf(R)===-1&&(z.offlineVideoStreams.push(R),l.push(bC(q,z,"transfer")));return g.Fu.all(l)})}),0)})},v0n=function(h,e){var t,Q,N,f,V;
return g.Y(function(R){if(R.D==1)return t=g.z2(e,"offlineVideoStreams"),g.Z(R,ar(h,t,"offlineVideoStreams"),2);Q=R.K;if(!Q||!Q.streamsProgress)return R.return();N=g.c(Q.streamsProgress);for(f=N.next();!f.done;f=N.next())V=f.value,V.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",V.numTotalBytes!==V.numBytesDownloaded&&(V.numBytesDownloaded=V.numTotalBytes);return g.Z(R,LI(h,Q,"offlineVideoStreams"),0)})},LDF=function(h,e,t,Q){if(h&&h.streamsProgress){Q=h;
a:{e=e.itag+";"+e.xtags;for(var N=h.streamsProgress,f=0;f<N.length;f++){var V=JSON.parse(N[f].formatStreamBytes);if(V.itag+";"+V.xtags===e){N[f]=t;t=N;break a}}N.push(t);t=N}Q.streamsProgress=t}else h={key:Q,streamsProgress:[t]};return h},Gx5=function(h){if(h==null?0:h.streamsProgress){var e=0;
h=h.streamsProgress;for(var t=0;t<h.length;t++){var Q=h[t];isNaN(Number(Q.numBytesDownloaded))?tO("stream progress bytes number invalid"):e+=Number(Q.numBytesDownloaded)}return e}return 0},sL9=function(h,e,t,Q){g.K.call(this);
var N=this;this.K=h;this.api=e;this.u1=t;this.zy=Q;this.X=new g.Qz;this.B=new g.fF(function(){N.D&&N.D.transferState==="TRANSFER_STATE_TRANSFERRING"&&N.X.G4()&&((N.D.transferRetryCount||0)<3?pl(N.J,N.V,!1,!1):kd(N.J,N.V.videoDetails.videoId),N.Lq("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.D$=this.jV=0;this.Y=this.W=!1;this.U$=g.iY(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.s$=new g.bZ(this);this.gL={JtW:function(){return N.B},
l4W:function(){return N.zy},
jR:function(){return N.X}};
this.gy=this.K.observe(this.rP.bind(this));this.J=new RhR(e,this);this.xR=new bGE(e);this.kR=new Kl(this.K);this.Aw=this.X.listen("publicytnetworkstatus-online",this.yB.bind(this));this.Jw=this.X.listen("publicytnetworkstatus-offline",this.MqX.bind(this));this.Y=this.api.U().L("html5_less_transfer_processing_logs");g.H(this,this.s$);this.s$.G(e,"offlinetransferpause",this.hZy);g.e9(this.api.U())?this.N="mainVideoDownloadStateEntity":g.Py(this.api.U())&&(this.N="musicTrackDownloadMetadataEntity")},
h_H=function(h){return g.Y(function(e){if(e.D==1)e=g.Z(e,FYE(),2);
else{var t=h.kR;var Q=g.nD();Q=Object.keys(Q);t=CxR(t,Q);e=g.Z(e,t,0)}return e})},E1=function(h,e){e=e===void 0?!1:e;
var t;return g.Y(function(Q){if(Q.D==1){if(h.D)throw Error("Already downloading a video");h.D$=0;h.W=!1;return g.Z(Q,oe5(h),2)}return Q.D!=4?(t=Q.K,QmR(h.u1,!t),t&&h.X.G4()?e?g.Z(Q,new Promise(function(N){g.TI(N,1E3)}),4):Q.Ty(4):(!t&&h.D&&Hh(h),Q.Ty(0))):g.Z(Q,e_L(h,t),0)})},t4R=function(h){return g.Y(function(e){if(e.D==1)return h.V?g.Z(e,kd(h.J,h.V.videoDetails.videoId),3):e.Ty(0);
Hh(h);g.cB(e)})},QLt=function(h,e){var t,Q,N;
return g.Y(function(f){switch(f.D){case 1:return g.Ik(f,2),(t=!!e.captionTracks.length||!!e.FA)?g.Z(f,Mxc(e.videoId),4):f.return();case 4:return(Q=f.K)?f.return():g.Z(f,Pxc(h.xR,e),5);case 5:g.iL(f,0);break;case 2:N=g.xP(f),tO("Caption downloading error",N,e.cotn),g.cB(f)}})},e_L=function(h,e){var t,Q,N,f,V,R;
return g.Y(function(u){switch(u.D){case 1:if(h.W)return u.return();h.W=!0;h.D=e;t=g.AJ(h.D.key);Q=t.entityId;N=void 0;if(h.D.transferState==="TRANSFER_STATE_TRANSFERRING")return g.Z(u,mj(h,Q),7);if(h.D.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||h.D.transferRetryCount||h.D.hasLoggedFirstStarted){u.Ty(3);break}return g.Z(u,mj(h,Q),5);case 5:return N=u.K,h.D.hasLoggedFirstStarted=!0,g.Z(u,NeS(h),6);case 6:NYS({videoId:Q,jI:h.D,offlineModeType:N},void 0,void 0,!0);u.Ty(3);break;case 7:N=u.K,
yd({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:Q,jI:h.D,offlineModeType:N});case 3:return g.Z(u,fiH(h),8);case 8:return f=null,g.Ik(u,9),g.Z(u,V4Z(h,e),11);case 11:f=u.K;h.V=f;g.iL(u,10);break;case 9:return V=g.xP(u),tO("error getting player response",V,e.cotn),g.Z(u,h.Lq("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return u.return();case 10:return R=u$f(h.api.U(),e.cotn,f),g.Z(u,QLt(h,R),13);case 13:return g.Z(u,UdE(R.videoId),
14);case 14:R.pX=u.K,zht(h.J,R,e.maximumDownloadQuality),h.B.start(108E5),g.cB(u)}})},oe5=function(h){var e,t;
return g.Y(function(Q){if(Q.D==1)return g.Z(Q,vm(h.K,"transfer"),2);e=Q.K;t=e.filter(yd9).sort(jLT);return t.length===0?Q.return():Q.return(t[0])})},fiH=function(h){var e,t,Q;
return g.Y(function(N){if(N.D==1){if(!h.D)return Bh(h,"onTransferStart"),N.return();h.B.start(108E5);return g.Z(N,b$(h,"TRANSFER_STATE_TRANSFERRING"),2)}e=h.D;return(Q=((t=e)==null?0:t.key)?g.AJ(e.key).entityId:"")&&h.N?g.Z(N,qh(Q,h.N,h.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):N.Ty(0)})},rZE=function(h){var e,t,Q,N;
g.Y(function(f){switch(f.D){case 1:if(!h.D){Bh(h,"onTransferPausedByUser");f.Ty(2);break}e=h.D;h.B.stop();return g.Z(f,b$(h,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:Q=((t=e)==null?0:t.key)?g.AJ(e.key).entityId:"";if(!Q||!h.N){f.Ty(4);break}return g.Z(f,qh(Q,h.N,h.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.Z(f,mj(h,Q),6);case 6:N=f.K,f1c({videoId:Q,jI:e,offlineModeType:N});case 2:Hh(h),E1(h),g.cB(f)}})},AZF=function(h){var e,t,Q;
g.Y(function(N){if(N.D==1){if(!h.D)return Bh(h,"onTransferPausedByNetwork"),N.return();h.B.stop();return g.Z(N,b$(h,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(N.D!=3)return e=h.D,(Q=((t=e)==null?0:t.key)?g.AJ(e.key).entityId:"")&&h.N?g.Z(N,qh(Q,h.N,h.K,"DOWNLOAD_STATE_PAUSED"),3):N.Ty(3);Hh(h);g.cB(N)})},R_R=function(h){var e,t,Q,N,f;
g.Y(function(V){switch(V.D){case 1:if(!h.D)return Bh(h,"onTransferComplete"),V.return();e=h.D;h.B.stop();if(!e||!h.V){V.Ty(2);break}t=u$f(h.api.U(),e.cotn,h.V);return g.Z(V,QLt(h,t),2);case 2:return g.Z(V,b$(h,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:N=((Q=e)==null?0:Q.key)?g.AJ(e.key).entityId:"";if(!N||!h.N){V.Ty(5);break}return g.Z(V,qh(N,h.N,h.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.Z(V,v0n(h.K,N),7);case 7:return g.Z(V,mj(h,N),8);case 8:f=V.K,yd({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:N,jI:e,offlineModeType:f}),Hh(h),E1(h),g.cB(V)}})},uhE=function(h,e,t){var Q,N;
g.Y(function(f){switch(f.D){case 1:if(!h.D)return Bh(h,"onTransferProgress: "+e),f.return();if(h.D.transferState==="TRANSFER_STATE_TRANSFERRING"){f.Ty(2);break}return g.Z(f,fiH(h),2);case 2:Q=Date.now();if(!(Q-h.jV>1E3)){f.Ty(4);break}h.jV=Q;return g.Z(f,a_T(h.K,t.videoId,t.K,t.Tw,t.bytesDownloaded,t.D),5);case 5:if(h.Y&&!(h.Y&&Q-h.D$>h.U$)){f.Ty(4);break}h.D$=Q;return g.Z(f,mj(h,e),7);case 7:N=f.K,NYS({videoId:e,jI:h.D,offlineModeType:N},t.bytesDownloaded,t.D);case 4:h.B.start(108E5),g.cB(f)}})},
UHR=function(h){var e=(h.D.transferRetryCount||0)<3;
e&&(h=h.D,h.transferRetryCount=(h.transferRetryCount||0)+1);return e},qTc=function(h,e){e=e===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":e;
var t,Q,N,f;return g.Y(function(V){if(V.D==1)return h.D||Bh(h,"setTransferToFailed: "+e),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e==="TRANSFER_FAILURE_REASON_NETWORK"?t="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":e==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.Z(V,b$(h,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",e),2);if(V.D!=3)return Nh(h.zy,{entityKey:(Q=h.D)==null?void 0:Q.key,failureReason:t}),
N=h.D?g.AJ(h.D.key).entityId:"",g.Z(V,mj(h,N),3);f=V.K;var R={videoId:N,jI:h.D,offlineModeType:f},u=e,U={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};u&&(U.transferFailureReason=u,U.failureReason=VCS(u));yd(U,R);g.cB(V)})},b$=function(h,e,t,Q){var N;
return g.Y(function(f){if(f.D==1){if(!h.D)return Bh(h,"saveTransferState: "+e),f.return();h.D.transferState=e;h.D.failureReason=Q;g.Ik(f,2);return g.Z(f,NeS(h,function(V){return t?mH(V,"offlineVideoStreams",h.D.offlineVideoStreams).then(function(R){for(var u=g.c(R),U=u.next();!U.done;U=u.next())if((U=U.value)&&U.streamsProgress){U=g.c(U.streamsProgress);for(var q=U.next();!q.done;q=U.next())q.value.streamState=t}return UGE(V,R.filter(function(r){return!!r}),"offlineVideoStreams")}):g.Fu.resolve(void 0)}),
4)}if(f.D!=2)return g.iL(f,0);
N=g.xP(f);return N instanceof g.Tt&&N.type==="QUOTA_EXCEEDED"?g.Z(f,h.Lq("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):f.Ty(0)})},NeS=function(h,e){var t;
return g.Y(function(Q){if(!h.D)return Q.return();t=h.D;return g.Z(Q,G3(h.K,{mode:"readwrite",sE:!0},function(N){var f=[bC(N,t,"transfer")];e&&f.push(e(N));return g.Fu.all(f)}),0)})},Hh=function(h){h.D=void 0;
h.V=void 0;h.B.stop()},V4Z=function(h,e){var t,Q,N,f,V;
return g.Y(function(R){if(R.D==1)return t=g.AJ(e.key),Q=t.entityId,N=g.z2(Q,"playbackData"),g.Z(R,ar(h.K,N,"playbackData"),2);f=R.K;if((V=f)==null?0:V.playerResponseJson)return R.return(JSON.parse(f.playerResponseJson));throw Error("No PlayerResponse found");})},Bh=function(h,e){h.api.RO("woffle",{mcte:e});
tO("missing current transfer entity.")},mj=function(h,e){var t,Q,N;
return g.Y(function(f){if(f.D==1)return g.Z(f,ar(h.K,g.z2(e,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);t=f.K;return f.return((N=(Q=t)==null?void 0:Q.offlineModeType)!=null?N:void 0)})},yd9=function(h){return rdf[h.transferState]!==void 0},jLT=function(h,e){var t=rdf[h.transferState],Q=rdf[e.transferState];
return t!==Q?t-Q:Number(h.enqueuedTimestampMs)-Number(e.enqueuedTimestampMs)},Ph=function(h,e){var t=this;
this.O$=h;this.api=e;this.X=new g.Qz;this.V=new g.WJ;this.gL={B9:function(){return t.N.gL.B9()},
jR:function(){return t.X},
KLa:function(){return t.N},
x8:function(){return t.x8()},
tv:function(){return t.tv()},
Av:function(){return t.Av()},
nE:function(){return t.nE()},
Ev:function(){return t.Ev()},
Bs:function(Q){return t.Bs(Q)}};
this.N=new hif(function(){return AdZ(t)},function(){t.Av()},this.api.dO(),this.api.L.bind(this.api));
this.D=new Qd(this.api);oBf(this.N)},AdZ=function(h){return g.Y(function(e){h.api.hw("onOrchestrationBecameLeader");
return g.Z(e,h.tv(),0)})},STf=function(h){var e,t;
return g.Y(function(Q){if(Q.D==1)return g.Z(Q,s1(),2);if(Q.D!=3){e=Q.K;if(!e)return tO("PES is undefined"),Q.return();h.K=new sL9(e,h.api,h.N,h.D);t=h.C1(e);return g.Z(Q,Yrf(e,t,h.N,h.D,h.O$),3)}h.J=Q.K;return g.Z(Q,z_5(h),0)})},z_5=function(h){var e;
return g.Y(function(t){switch(t.D){case 1:if(!h.K)return tO("transferManager is undefined"),t.return();if(h.K.D){t.Ty(2);break}return g.Z(t,E1(h.K),2);case 2:if(!h.O$.L("woffle_enable_main_downloads_library")){t.Ty(4);break}return g.Z(t,h.Ej(),4);case 4:if(!h.O$.L("html5_offline_playback_position_sync")){t.Ty(6);break}return g.Z(t,h.wq(),7);case 7:return g.Z(t,h.Bs(864E5),6);case 6:return g.Z(t,h.refreshAllStaleEntities(43200,!0),9);case 9:return g.Z(t,h.cX(),10);case 10:if(!h.O$.L("html5_retry_downloads_for_expiration")){t.Ty(11);
break}return g.Z(t,h.Ev(),11);case 11:return h.W=g.OQ(function(){h.refreshAllStaleEntities(43200,!0);h.cX()},9E5),g.Vp(g.jh(),function(){return h.nE()}),g.Z(t,s1(),13);
case 13:return e=t.K,g.Z(t,smH(e),14);case 14:ei5(h.N),g.cB(t)}})},Jd9=function(){var h,e,t,Q,N,f;
return g.Y(function(V){switch(V.D){case 1:return g.Z(V,s1(),2);case 2:h=V.K;if(!h)return V.return([]);e=Date.now()/1E3;return g.Z(V,vm(h,"offlineVideoPolicy"),3);case 3:t=V.K,Q=g.c(t),N=Q.next();case 4:if(N.done){V.Ty(6);break}f=N.value;if(!(f.expirationTimestamp&&Number(f.expirationTimestamp)<e)){V.Ty(5);break}f.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";f.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.Z(V,LI(h,f,"offlineVideoPolicy"),5);
case 5:N=Q.next();V.Ty(4);break;case 6:return V.return(t.map(function(R){return R.key}))}})},Mh=function(h,e,t,Q,N){var f,V,R;
return g.Y(function(u){if(u.D==1)return g.Z(u,s1(),2);f=u.K;if(!f)return u.return([]);V=e.map(function(U){var q=g.z2(U,t);q={actionType:Q,entityKey:q,actionMetadata:Object.assign({},UgS(),N)};Q!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(q.actionMetadata.priority=0);U=new Sc(t,U,q);return ch(U)});
R=lMZ(f,V);oBf(h.N);return u.return(R)})},cdH=function(h,e,t,Q){var N,f,V,R,u,U,q,r;
return g.Y(function(A){switch(A.D){case 1:N=[],f=g.c(e),V=f.next();case 2:if(V.done){A.Ty(4);break}R=V.value;if(R.upToDate||t&&!R.shouldAutoSyncMetadata||!R.playlistId){A.Ty(3);break}u={};switch(Q){case "mainPlaylistEntity":U={nextAutoRefreshIntervalSeconds:R.checkInSeconds,autoSync:t};u={mainPlaylistEntityActionMetadata:U};break;case "musicPlaylist":q={autoSync:t},u={musicPlaylistEntityActionMetadata:q}}return g.Z(A,Mh(h,[R.playlistId],Q,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u),6);case 6:(r=
A.K)&&N.push.apply(N,g.x(r));case 3:V=f.next();A.Ty(2);break;case 4:return A.return(N)}})},Ii9=function(h,e){var t;
return g.Y(function(Q){return e.length?(t=UgS(),g.Ln(t,nl,{isEnqueuedForExpiredStreamUrlRefetch:!0}),h.api.RO("qrd",{v:e.length}),Q.return(Mh(h,e,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t))):Q.return([])})},liF=function(h,e,t){this.D=h;
this.O$=e;this.N=t},WMF=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w;
return g.Y(function(F){switch(F.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,f=[],g.Ik(F,2),g.Z(F,iFZ(h,N),4);case 4:f=F.K;if(!(h.O$.L("woffle_enable_main_downloads_library")&&((V=f)==null?0:V.length))){F.Ty(5);break}return g.Z(F,TYt(h.D,[e.entityKey]),5);case 5:g.iL(F,3);break;case 2:return R=g.xP(F),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Tt&&R.type==="QUOTA_EXCEEDED"?(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):tO("Playlist add error"),F.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,u,U));case 3:q=[];if(!h.O$.L("html5_offline_prevent_redownload_downloaded_video")){F.Ty(7);break}return g.Z(F,RiZ(h.D,"mainVideoEntity",f),8);case 8:f=F.K;case 7:if((r=f)==null?0:r.length)for(A=g.c(f),z=A.next();!z.done;z=A.next())if(S=z.value,l=S.offlineVideoData,W=void 0,(W=l)==null?0:W.videoId)O=void 0,w=Number(((O=e.actionMetadata)==null?void 0:O.priority)||
0)+1,q.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l.videoId,"mainVideoEntity",w,Cl,xHR(e,l,N)));return F.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,q))}})},OFE=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At,T,d,X,n,p,h$,Q5,NX,D,Rk,zP,y5,Xx,qZ,p5,Ux,BB,$l,yL,FF,P6,UY,bO,KB,Pf,lO,qB,Zz,q0,FI,Dk,kj,dW,a1,MS,ev,Tx,Ey;
return g.Y(function(qx){switch(qx.D){case 1:return t=jc(e),Q=e.entityKey,N=g.AJ(Q).entityId,f=[],V=!1,N==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.Z(qx,vm(h.D,"mainPlaylistEntity"),5)):g.Z(qx,ar(h.D,Q,"mainPlaylistEntity"),4);case 4:(R=qx.K)&&f.push(R);qx.Ty(3);break;case 5:f=qx.K;case 3:if((u=f)==null||!u.length)return qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));U=g.m(e.actionMetadata,Te9);r=(q=U)==null?void 0:q.nextAutoRefreshIntervalSeconds;z=(A=U)==null?void 0:A.autoSync;S=[];W=l=
!0;O=!1;if(!V&&z===!1){qx.Ty(6);break}g.Ik(qx,7);return g.Z(qx,KN5(0,!!z,!0,f),9);case 9:S=qx.K;g.iL(qx,8);break;case 7:w=g.xP(qx);if(!(w instanceof Error&&w.message==="No data")){w instanceof Error&&w.message==="Empty response body"&&tO(w.message);qx.Ty(8);break}return N==="!*$_ALL_ENTITIES_!*$"?g.Z(qx,c3E(h.D,e,h.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.Z(qx,SMc(N,h.D,e,h.N),8);case 8:if(!S.length||!V&&S[0].playlistId!==N)return qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));case 6:if(V){F=[];k=g.c(S);for(E=k.next();!E.done;E=k.next())G=E.value,G.upToDate||z&&!G.shouldAutoSyncMetadata||!G.playlistId||(C={nextAutoRefreshIntervalSeconds:G.checkInSeconds,autoSync:z},F.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G.playlistId,"mainPlaylistEntity",0,Cl,{mainPlaylistEntityActionMetadata:C})));return qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,F))}S.length&&(t$=S[0],O=!!t$.upToDate,z&&(l=(fv=t$.shouldAutoSyncMetadata)!=null?fv:!0,W=(sU=t$.shouldAutoSyncVideos)!=
null?sU:!0,t$.checkInSeconds&&(r=t$.checkInSeconds)));if(O||!l)return qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));B=[];v=f[0];if(!v.downloadState){I=void 0;qx.Ty(15);break}return g.Z(qx,ar(h.D,v.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:I=qx.K;case 15:return b=I,IE=((Kv=b)==null?0:Kv.addedTimestampMillis)?String(b.addedTimestampMillis):void 0,g.Ik(qx,17),g.Z(qx,iFZ(h,N,IE,r),19);case 19:B=qx.K;g.iL(qx,18);break;case 17:UL=g.xP(qx);if(!(UL instanceof Error&&
UL.message==="No data for playlist")){if(UL instanceof Error&&UL.message==="Empty response body for playlist")tO(UL.message);else return OU="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Lv="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",UL instanceof g.Tt&&UL.type==="QUOTA_EXCEEDED"&&(OU="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Lv="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,OU,Lv));qx.Ty(18);
break}return g.Z(qx,SMc(N,h.D,e,h.N),18);case 18:if(!W)return qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));QT=[];At=new Map;if((T=B)==null?0:T.length)for(d=g.c(B),X=d.next();!X.done;X=d.next())n=X.value,p=n.offlineVideoData,h$=void 0,((h$=p)==null?0:h$.videoId)&&At.set(p.videoId,p);Q5=new Map;NX=[];if((D=v)==null?0:(Rk=D.videos)==null?0:Rk.length)for(zP=g.c(v.videos),y5=zP.next();!y5.done;y5=zP.next())if(Xx=y5.value,qZ=JSON.parse(g.AJ(Xx).entityId),p5=qZ.videoId)At.has(p5)?(Q5.set(p5,
At.get(p5)),At.delete(p5)):NX.push(p5);BB=Number(((Ux=e.actionMetadata)==null?void 0:Ux.priority)||0)+1;$l=g.c(At.entries());for(yL=$l.next();!yL.done;yL=$l.next())FF=yL.value,P6=g.c(FF),UY=P6.next().value,bO=P6.next().value,KB=UY,Pf=bO,QT.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",KB,"mainVideoEntity",BB,Cl,xHR(e,Pf,N)));lO=g.c(Q5.entries());for(qB=lO.next();!qB.done;qB=lO.next())Zz=qB.value,q0=g.c(Zz),FI=q0.next().value,Dk=q0.next().value,kj=FI,dW=Dk,QT.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
kj,"mainVideoEntity",BB,Cl,xHR(e,dW,N)));a1=g.c(NX);for(MS=a1.next();!MS.done;MS=a1.next())ev=MS.value,Tx={playlistId:N},Ey={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Tx},QT.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",ev,"mainVideoEntity",0,Cl,Ey));return qx.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,QT))}})},geE=function(h,e){var t,Q,N,f;
return g.Y(function(V){switch(V.D){case 1:return t=jc(e),g.Ik(V,2),Q=g.AJ(e.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.Z(V,c3E(h.D,e,h.N,(N=e.actionMetadata)==null?void 0:(f=N.offlineLoggingData)==null?void 0:f.offlineDeleteReason),5):g.Z(V,SMc(Q,h.D,e,h.N),6);case 6:if(!h.O$.L("woffle_enable_main_downloads_library")){V.Ty(5);break}return g.Z(V,OMT(h.D,e.entityKey),5);case 5:g.iL(V,3);break;case 2:return g.xP(V),V.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},iFZ=function(h,e,t,Q){var N,f,V,R,u,U,q;
return g.Y(function(r){switch(r.D){case 1:return g.Z(r,pzE([e]),2);case 2:return N=r.K,g.Z(r,dHT(h,N[0],t,Q),3);case 3:return f=r.K,V=f.mainPlaylistEntity,R=f.zNy,U=A3T(V,(u=R)==null?void 0:u.avatar),g.Ik(r,4),g.Z(r,l$(U),6);case 6:g.iL(r,5);break;case 4:q=g.xP(r),q instanceof Error&&q.message==="Failed to fetch"&&tO(q.message);case 5:return r.return(N[0].videos)}})},dHT=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k;
return g.Y(function(E){switch(E.D){case 1:N=Date.now().toString();t||(t=N);f=e.videos;V=e.playlistId;R=[];u=[];if(f)for(U=g.c(f),q=U.next();!q.done;q=U.next()){r=q.value;A=r.offlineVideoData;if(!A||!A.videoId)throw tO("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");z=A.videoId;S={videoId:z,playlistId:V};l={id:g.z2(JSON.stringify(S),"mainPlaylistVideoEntity"),video:g.z2(z,"mainVideoEntity")};R.push(l);u.push(l.id)}O={key:g.z2(V,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:t,lastSyncedTimestampMillis:N};w={key:g.z2(V,"mainPlaylistEntity"),playlistId:V,videos:u,title:e.title,thumbnailStyleData:w_R(e),visibility:X_c(e),downloadState:O.key};e.channel&&(F=e.channel.offlineChannelData,W=ZF5(g.z2(V,"ytMainChannelEntity"),F),w.channelOwner=W.id);((k=w)==null?0:k.entityMetadata)?(w.entityMetadata.offlineLastModifiedTimestampSeconds=e.lastModifiedTimestamp,Q&&(w.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q))):w&&(w.entityMetadata={nextAutoRefreshIntervalSeconds:Q?
String(Q):void 0,offlineLastModifiedTimestampSeconds:e.lastModifiedTimestamp});g.Ik(E,2);return g.Z(E,G3(h.D,{mode:"readwrite",sE:!0},function(G){var C=bC(G,w,"mainPlaylistEntity"),t$=bC(G,O,"mainPlaylistDownloadStateEntity");C=[C,t$];t$=g.c(R);for(var fv=t$.next();!fv.done;fv=t$.next())C.push(bC(G,fv.value,"mainPlaylistVideoEntity"));W&&C.push(bC(G,W,"ytMainChannelEntity"));return g.Fu.all(C)}),4);
case 4:g.iL(E,3);break;case 2:throw g.xP(E),tO("PES failure for playlist"),Error("PES failure for playlist");case 3:return E.return({mainPlaylistEntity:w,zNy:W,A1$:R})}})},ZF5=function(h,e){return{id:h,
channelId:e.channelId,title:e.title,avatar:e.thumbnail}},w_R=function(h){var e=[],t=h.videos;
t&&t.length>0&&e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:t[0].offlineVideoData.thumbnail}}});if((h=h.additionalMetadadatas)&&h.length>0)for(h=g.c(h),t=h.next();!t.done;t=h.next()){var Q=t.value.offlineBundleItemPlaylistData,N=void 0;t=(N=Q)==null?void 0:N.style;N=void 0;Q={collageThumbnail:{coverThumbnail:(N=Q)==null?void 0:N.coverThumbnail}};switch(t){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:Q});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":e.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:Q})}}return e},X_c=function(h){switch(h.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},xHR=function(h,e,t){e={offlineVideoData:e,
playlistId:t};if(h=g.m(h.actionMetadata,Te9))e.maximumDownloadQuality=h.maximumDownloadQuality;return{mainVideoEntityActionMetadata:e}},FML=function(h,e,t){this.D=h;
this.O$=e;this.N=t},DH5=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S;
return g.Y(function(l){switch(l.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,f=g.m(e.actionMetadata,Gp),R=!((V=f)==null?0:V.playlistId),g.Ik(l,2),g.Z(l,YTZ(h,N,void 0,(u=f)==null?void 0:u.offlineVideoData,R),4);case 4:g.iL(l,3);break;case 2:return U=g.xP(l),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.Tt&&U.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,q,r));case 3:A=1;A=Number(((z=e.actionMetadata)==null?void 0:z.priority)||0)+1;var W=(W=g.m(e.actionMetadata,Gp))?{playbackDataActionMetadata:{maximumDownloadQuality:W.maximumDownloadQuality}}:void 0;S=Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N,"playbackData",A,nec,W);return l.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,[S]))}})},kVE=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w;
return g.Y(function(F){switch(F.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,g.Z(F,ar(h.D,e.entityKey,"mainVideoEntity"),2);case 2:f=F.K;if(!f){V=void 0;F.Ty(3);break}return g.Z(F,ar(h.D,f.downloadState,"mainVideoDownloadStateEntity"),4);case 4:V=F.K;case 3:R=V;if(!f||!R)return F.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Ik(F,5);return g.Z(F,YTZ(h,N,R.addedTimestampMillis,(U=g.m(e.actionMetadata,Gp))==null?void 0:U.offlineVideoData),7);case 7:q=1;q=Number(((r=
e.actionMetadata)==null?void 0:r.priority)||0)+1;u=Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"playbackData",q,nec);g.iL(F,6);break;case 5:A=g.xP(F);if(!(A instanceof Error&&A.message==="No data")){if(A instanceof Error&&A.message==="Empty response body")tO(A.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.Tt&&A.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,z,S));F.Ty(6);break}return g.Z(F,Wh(h.D,N),9);case 9:l=F.K;W=g.m(e.actionMetadata,Gp);if(w=(O=W)==null?void 0:O.playlistId)l.playlistId=w;l.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.Z(F,i$(N,h.D,e,h.N,l),6);case 6:return F.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,u?[u]:void 0))}})},p_f=function(h,e){var t,Q,N,f,V,R,u,U,q,r;
return g.Y(function(A){switch(A.D){case 1:return t=jc(e),g.Ik(A,2),Q=g.AJ(e.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.Z(A,c3E(h.D,e,h.N,(q=e.actionMetadata)==null?void 0:(r=q.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.Z(A,Wh(h.D,Q),6);case 6:N=A.K;f=g.m(e.actionMetadata,Gp);if(R=(V=f)==null?void 0:V.playlistId)N.playlistId=R;N.offlineDeleteReason=(u=e.actionMetadata)==null?void 0:(U=u.offlineLoggingData)==null?void 0:U.offlineDeleteReason;return g.Z(A,i$(Q,h.D,e,h.N,N),7);
case 7:if(!h.O$.L("woffle_enable_main_downloads_library")){A.Ty(5);break}return g.Z(A,OMT(h.D,e.entityKey),5);case 5:g.iL(A,3);break;case 2:return g.xP(A),A.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},YTZ=function(h,e,t,Q,N){var f,V,R,u,U,q;
return g.Y(function(r){switch(r.D){case 1:if(f=Q){r.Ty(2);break}return g.Z(r,kLE([e]),3);case 3:V=r.K,f=V[0];case 2:return g.Z(r,$H5(h,f,t,N),4);case 4:R=r.K;u=R.mainVideoEntity;U=R.channelEntity;g.Ik(r,5);var A=zp(u.thumbnail),z=zp(U.avatar);return g.Z(r,l$(A.concat(z)),7);case 7:g.iL(r,0);break;case 5:q=g.xP(r),q instanceof Error&&q.message==="Failed to fetch"&&tO(q.message),g.cB(r)}})},$H5=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A,z,S,l,W;
return g.Y(function(O){switch(O.D){case 1:t||(t=Date.now().toString());f=(N=e.channel)==null?void 0:N.offlineChannelData;V={id:g.z2(e.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail};R={key:g.z2(e.videoId,"mainVideoDownloadStateEntity"),playbackData:g.z2(e.videoId,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.z2(e.videoId,"videoDownloadContextEntity")};u={key:g.z2(e.videoId,"videoPlaybackPositionEntity"),videoId:e.videoId,lastPlaybackPositionSeconds:"0"};
h.O$.L("html5_offline_playback_position_sync")&&(U={playbackPosition:u.key});q=g.z2(e.videoId,"mainVideoEntity");r={key:q,videoId:e.videoId,title:e.title,thumbnail:e.thumbnail,localizedStrings:{viewCount:e.shortViewCountText},userState:U,lengthSeconds:e.lengthSeconds?Number(e.lengthSeconds):void 0,publishedTimestampMillis:e.publishedTimestamp?(Number(e.publishedTimestamp)*1E3).toString():void 0,formattedDescription:e.description,owner:V.id,downloadState:R.key};if(!h.O$.L("woffle_enable_main_downloads_library")||
!Q){O.Ty(2);break}return g.Z(O,WNZ(h.D,[q]),3);case 3:if(S=O.K)A=S.mainDownloadsLibraryEntity,z=S.mainDownloadsListEntity;case 2:return W=jmE,l={key:g.z2(e.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Ln(R,W,l),g.Z(O,G3(h.D,{mode:"readwrite",sE:!0},function(w){var F=bC(w,V,"ytMainChannelEntity"),k=bC(w,R,"mainVideoDownloadStateEntity"),E=bC(w,r,"mainVideoEntity");F=[F,k,E];h.O$.L("html5_offline_playback_position_sync")&&(k=bC(w,u,"videoPlaybackPositionEntity"),
F.push(k));A&&(k=bC(w,A,"mainDownloadsLibraryEntity"),F.push(k));z&&(k=bC(w,z,"mainDownloadsListEntity"),F.push(k));l&&(w=bC(w,l,"downloadStatusEntity"),F.push(w));return g.Fu.all(F)}),4);
case 4:return O.return({mainVideoEntity:r,channelEntity:V})}})},KML=function(h,e,t){this.D=h;
this.O$=e;this.N=t},Eet=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v;
return g.Y(function(I){switch(I.D){case 1:return t=jc(e),Q=[],g.Z(I,$M.getInstance(),2);case 2:N=I.K;if(!N){I.Ty(3);break}return g.Z(I,N.get("sdois"),4);case 4:return f=I.K,g.Z(I,(R=N)==null?void 0:R.get("lmqf"),5);case 5:V=I.K;case 3:g.Ik(I,6);if(f===void 0)throw Error("prefStorage or opt-in state is undefined");u=[];if(f){I.Ty(8);break}return g.Z(I,xgF(h.D),9);case 9:u=I.K,u.reverse();case 8:if(!u.length){I.Ty(10);break}U=g.c(u);q=U.next();case 11:if(q.done){I.Ty(10);break}r=q.value;if(!r){I.Ty(12);
break}A=g.AJ(r).entityId;return g.Z(I,Wh(h.D,A),14);case 14:return z=I.K,z.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.Z(I,i$(A,h.D,{entityKey:r,actionType:e.actionType},h.N,z),12);case 12:q=U.next();I.Ty(11);break;case 10:return g.Z(I,EBE(f,(S=V)!=null?S:"SD"),16);case 16:return l=I.K,g.Z(I,I1t(l),17);case 17:W=iMH(l);if(!h.O$.L("woffle_enable_main_downloads_library")){I.Ty(18);break}if(f){I.Ty(19);break}return g.Z(I,OMT(h.D,g.nN),19);case 19:return g.Z(I,TYt(h.D,[g.nN]),18);
case 18:if((O=W)==null?0:O.length)for(w=g.c(W),F=w.next();!F.done;F=w.next())if(E=k=F.value,G=E.actionType,C=E.entityKey,t$=E.actionMetadata,G&&C&&t$&&!g.m(t$,HFF)){G==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(t$.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(fv=g.m(k.actionMetadata,Gp))fv.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",k.actionMetadata=Object.assign({},k.actionMetadata,{mainVideoEntityActionMetadata:fv});Q.push(k)}g.iL(I,7);break;
case 6:return sU=g.xP(I),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",sU instanceof g.Tt&&sU.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,B,v));case 7:return I.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,Q))}})},mHn=function(){Ph.apply(this,arguments);
this.Y="mainVideoEntity"},Bec=function(h,e,t){e=e===void 0?43200:e;
t=t===void 0?!0:t;var Q=Q===void 0?!1:Q;var N,f,V;return g.Y(function(R){switch(R.D){case 1:if(!h.X.G4())return R.return([]);N=[];g.Ik(R,2);return g.Z(R,KN5(e,t,Q),4);case 4:N=R.K;g.iL(R,3);break;case 2:f=g.xP(R),f instanceof Error&&f.message==="No data"||f instanceof Error&&f.message==="Empty response body"&&tO(f.message);case 3:return V=cdH(h,N,t,"mainPlaylistEntity"),R.return(V)}})},bFT=function(h,e,t,Q){Q=Q===void 0?!1:Q;
var N,f,V,R,u,U,q,r,A,z,S,l,W,O,w;return g.Y(function(F){switch(F.D){case 1:return N=[],g.Z(F,HM5(),2);case 2:return(f=F.K)||Q?g.Z(F,mgE(e,t),3):F.return([]);case 3:V=F.K;if((R=V)==null||!R.length)return F.return([]);u={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};U=g.c(V);q=U.next();case 4:if(q.done){F.Ty(6);break}A=r=q.value;z=A.actionType;S=A.entityKey;l=A.actionMetadata;if(!(z&&S&&l)||g.m(l,HFF)){F.Ty(5);break}z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(l.offlineLoggingData=
u);W=g.AJ(S);O=W.entityId;return g.Z(F,Mh(h,[O],"mainVideoEntity",z,l),8);case 8:w=F.K,N=N.concat(w);case 5:q=U.next();F.Ty(4);break;case 6:return F.return(N)}})},P25=function(h,e){this.D=h;
this.N=e},C2n=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O;
return g.Y(function(w){switch(w.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,f=[],g.Ik(w,2),g.Z(w,M4c(h,N),4);case 4:f=w.K;if((V=f)==null||!V.length){w.Ty(5);break}return g.Z(w,ZMT(h.D,e.entityKey),5);case 5:g.iL(w,3);break;case 2:return R=g.xP(w),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Tt&&R.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,u,U));case 3:return q=[],g.Z(w,RiZ(h.D,"musicTrack",f),7);case 7:f=w.K;if(f.length)for(r=g.c(f),A=r.next();!A.done;A=r.next())if(z=A.value,S=z.offlineVideoData,l=void 0,(l=S)==null?0:l.videoId)W=void 0,O=Number(((W=e.actionMetadata)==null?void 0:W.priority)||0)+1,q.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"musicTrack",O,Ll,dc(e,S,N)));return w.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,q))}})},
GVZ=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At,T,d,X,n,p,h$,Q5,NX,D,Rk,zP,y5,Xx,qZ,p5,Ux,BB,$l,yL,FF,P6,UY,bO;
return g.Y(function(KB){switch(KB.D){case 1:return t=jc(e),Q=e.entityKey,N=g.AJ(Q).entityId,f=[],V=!1,N==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.Z(KB,vm(h.D,"musicAlbumRelease"),5)):g.Z(KB,ar(h.D,Q,"musicAlbumRelease"),4);case 4:(R=KB.K)&&f.push(R);KB.Ty(3);break;case 5:f=KB.K;case 3:if((u=f)==null||!u.length)return KB.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));if(V){U=[];q=g.c(f);for(r=q.next();!r.done;r=q.next())A=r.value,z=g.AJ(A.id).entityId,U.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
z,"musicAlbumRelease",0,Ll));return KB.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,U))}S=[];l=f[0];W=void 0;if(!l.downloadMetadata){KB.Ty(6);break}return g.Z(KB,ar(h.D,l.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:O=KB.K,W=Number((F=(w=O)==null?void 0:w.addedTimestampMillis)!=null?F:"0")/1E3;case 6:return g.Ik(KB,8),g.Z(KB,M4c(h,N,(k=W)==null?void 0:k.toString()),10);case 10:S=KB.K;g.iL(KB,9);break;case 8:E=g.xP(KB);if(!(E instanceof Error&&E.message===
"No data")){if(E instanceof Error&&E.message==="Empty response body")tO(E.message);else return G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.Tt&&E.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),KB.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,G,C));KB.Ty(9);break}return g.Z(KB,O1(N,"musicAlbumRelease",h.D,
e,h.N),9);case 9:t$=[];fv=new Map;if((sU=S)==null?0:sU.length)for(B=g.c(S),v=B.next();!v.done;v=B.next())I=v.value,b=I.offlineVideoData,Kv=void 0,((Kv=b)==null?0:Kv.videoId)&&fv.set(b.videoId,b);IE=new Map;UL=[];if((OU=l)==null?0:(Lv=OU.tracks)==null?0:Lv.length)for(QT=g.c(l.tracks),At=QT.next();!At.done;At=QT.next())if(T=At.value,d=g.AJ(T).entityId)fv.has(d)?(IE.set(d,fv.get(d)),fv.delete(d)):UL.push(d);n=Number(((X=e.actionMetadata)==null?void 0:X.priority)||0)+1;p=g.c(fv.entries());for(h$=p.next();!h$.done;h$=
p.next())Q5=h$.value,NX=g.c(Q5),D=NX.next().value,Rk=NX.next().value,zP=D,y5=Rk,t$.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",zP,"musicTrack",n,Ll,dc(e,y5)));Xx=g.c(IE.entries());for(qZ=Xx.next();!qZ.done;qZ=Xx.next())p5=qZ.value,Ux=g.c(p5),BB=Ux.next().value,$l=Ux.next().value,yL=BB,FF=$l,t$.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",yL,"musicTrack",n,Ll,dc(e,FF)));P6=g.c(UL);for(UY=P6.next();!UY.done;UY=P6.next())bO=UY.value,t$.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",bO,
"musicTrack",0,Ll));return KB.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,t$))}})},LML=function(h,e){var t,Q;
return g.Y(function(N){switch(N.D){case 1:return t=jc(e),g.Ik(N,2),Q=g.AJ(e.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.Z(N,gc(h.D,e,h.N),5):g.Z(N,O1(Q,"musicAlbumRelease",h.D,e,h.N),6);case 6:return g.Z(N,FNH(h.D,e.entityKey),5);case 5:g.iL(N,3);break;case 2:return g.xP(N),N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},M4c=function(h,e,t){var Q,N,f;
return g.Y(function(V){switch(V.D){case 1:return g.Z(V,pzE([e]),2);case 2:return Q=V.K,g.Z(V,aiR(h,Q[0],t),3);case 3:return N=V.K,f=zp(N.thumbnailDetails),g.Z(V,l$(f),4);case 4:return V.return(Q[0].videos)}})},aiR=function(h,e,t){var Q,N,f,V,R,u,U,q,r,A,z,S,l,W;
return g.Y(function(O){if(O.D==1){Q=e.additionalMetadadatas;N=void 0;if(Q&&Q.length>0)for(f=g.c(Q),V=f.next();!V.done;V=f.next())if(R=V.value,R.offlineMusicPlaylistData){N=R.offlineMusicPlaylistData;break}u=e.playlistId;U=YMH(e);q=U.Hv;r=U.FJ;A=t?(Number(t)*1E3).toString():Date.now().toString();z=e.lastModifiedTimestamp?(Number(e.lastModifiedTimestamp)*1E3).toString():"0";S={id:g.z2(u,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:z,addedTimestampMillis:A,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};l={id:g.z2(u,"musicAlbumRelease"),title:e.title,audioPlaylistId:u,trackCount:e.totalVideoCount,tracks:q,downloadMetadata:S.id};N&&(l.thumbnailDetails=(W=N.albumHqThumbnail)!=null?W:N.albumArtistThumbnail,l.artistDisplayName=N.albumArtistDisplayName,l.releaseDate=N.albumReleaseDate,l.contentRating={explicitType:N.albumReleaseExplicitType},l.releaseType=N.albumReleaseType);return g.Z(O,G3(h.D,{mode:"readwrite",sE:!0},function(w){var F=bC(w,l,"musicAlbumRelease");
w=bC(w,S,"musicAlbumReleaseDownloadMetadataEntity");return g.Fu.all([F,w])}),2)}return O.return(l)})},veZ=function(h,e){this.D=h;
this.N=e},hSn=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O;
return g.Y(function(w){switch(w.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,f=[],g.Ik(w,2),g.Z(w,s35(h,N),4);case 4:f=w.K;if((V=f)==null||!V.length){w.Ty(5);break}return g.Z(w,ZMT(h.D,e.entityKey),5);case 5:g.iL(w,3);break;case 2:return R=g.xP(w),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Tt&&R.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,u,U));case 3:return q=[],g.Z(w,RiZ(h.D,"musicTrack",f),7);case 7:f=w.K;if(f.length)for(r=g.c(f),A=r.next();!A.done;A=r.next())if(z=A.value,S=z.offlineVideoData,l=void 0,(l=S)==null?0:l.videoId)W=void 0,O=Number(((W=e.actionMetadata)==null?void 0:W.priority)||0)+1,q.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S.videoId,"musicTrack",O,aR,dc(e,S,N)));return w.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,q))}})},
o1T=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At,T,d,X,n,p,h$,Q5,NX,D,Rk,zP,y5,Xx,qZ,p5,Ux,BB,$l,yL,FF,P6,UY,bO,KB,Pf,lO,qB,Zz,q0,FI,Dk,kj,dW,a1,MS;
return g.Y(function(ev){switch(ev.D){case 1:return t=jc(e),Q=e.entityKey,N=g.AJ(Q).entityId,f=[],V=!1,N==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.Z(ev,vm(h.D,"musicPlaylist"),5)):g.Z(ev,ar(h.D,Q,"musicPlaylist"),4);case 4:(R=ev.K)&&f.push(R);ev.Ty(3);break;case 5:f=ev.K;case 3:if((u=f)==null||!u.length)return ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));U=g.m(e.actionMetadata,nBE);r=(q=U)==null?void 0:q.autoSync;A=[];S=z=!0;l=!1;W=void 0;if(!V&&r===!1){ev.Ty(6);break}g.Ik(ev,7);return g.Z(ev,
BYZ(0,!!r,!0,f),9);case 9:A=ev.K;g.iL(ev,8);break;case 7:O=g.xP(ev);if(!(O instanceof Error&&O.message==="No data")){O instanceof Error&&O.message==="Empty response body"&&tO(O.message);ev.Ty(8);break}return N==="!*$_ALL_ENTITIES_!*$"?g.Z(ev,gc(h.D,e,h.N),8):g.Z(ev,O1(N,"musicPlaylist",h.D,e,h.N),8);case 8:if(!A.length||!V&&A[0].playlistId!==N)return ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));case 6:if(V){w=[];F=g.c(A);for(k=F.next();!k.done;k=F.next())E=k.value,E.upToDate||
r&&!E.shouldAutoSyncMetadata||!E.playlistId||(G={autoSync:r},w.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E.playlistId,"musicPlaylist",0,aR,{musicPlaylistEntityActionMetadata:G})));return ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,w))}A.length&&(C=A[0],l=!!C.upToDate,r&&(z=(t$=C.shouldAutoSyncMetadata)!=null?t$:!0,S=(fv=C.shouldAutoSyncVideos)!=null?fv:!0,C.checkInSeconds&&(W=C.checkInSeconds)));if(l||!z)return ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));sU=[];B=f[0];v=void 0;if(!B.downloadMetadata){ev.Ty(15);break}return g.Z(ev,ar(h.D,B.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:I=ev.K,v=Number((Kv=(b=I)==null?void 0:b.addedTimestampMillis)!=null?Kv:"0")/1E3;case 15:return g.Ik(ev,17),g.Z(ev,s35(h,N,(IE=v)==null?void 0:IE.toString(),W),19);case 19:sU=ev.K;g.iL(ev,18);break;case 17:UL=g.xP(ev);if(!(UL instanceof Error&&UL.message==="No data")){if(UL instanceof Error&&UL.message==="Empty response body")tO(UL.message);else return OU=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Lv="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",UL instanceof g.Tt&&UL.type==="QUOTA_EXCEEDED"&&(OU="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Lv="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,OU,Lv));ev.Ty(18);break}return g.Z(ev,O1(N,"musicPlaylist",h.D,e,h.N),18);case 18:if(!S)return ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));QT=[];At=new Map;if((T=sU)==null?0:T.length)for(d=g.c(sU),X=d.next();!X.done;X=d.next())n=X.value,p=n.offlineVideoData,h$=void 0,((h$=p)==null?0:h$.videoId)&&At.set(p.videoId,p);Q5=new Map;NX=[];if((D=B)==null?0:(Rk=D.tracks)==null?0:Rk.length)for(zP=g.c(B.tracks),y5=zP.next();!y5.done;y5=zP.next())if(Xx=y5.value,qZ=g.AJ(Xx).entityId)At.has(qZ)?(Q5.set(qZ,At.get(qZ)),At.delete(qZ)):NX.push(qZ);Ux=Number(((p5=e.actionMetadata)==null?void 0:p5.priority)||0)+1;BB=g.c(At.entries());for($l=BB.next();!$l.done;$l=
BB.next())yL=$l.value,FF=g.c(yL),P6=FF.next().value,UY=FF.next().value,bO=P6,KB=UY,QT.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",bO,"musicTrack",Ux,aR,dc(e,KB)));Pf=g.c(Q5.entries());for(lO=Pf.next();!lO.done;lO=Pf.next())qB=lO.value,Zz=g.c(qB),q0=Zz.next().value,FI=Zz.next().value,Dk=q0,kj=FI,QT.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Dk,"musicTrack",Ux,aR,dc(e,kj)));dW=g.c(NX);for(a1=dW.next();!a1.done;a1=dW.next())MS=a1.value,QT.push(Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
MS,"musicTrack",0,aR));return ev.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,QT))}})},eST=function(h,e){var t,Q;
return g.Y(function(N){switch(N.D){case 1:return t=jc(e),g.Ik(N,2),Q=g.AJ(e.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.Z(N,gc(h.D,e,h.N),5):g.Z(N,O1(Q,"musicPlaylist",h.D,e,h.N),6);case 6:return g.Z(N,FNH(h.D,e.entityKey),5);case 5:g.iL(N,3);break;case 2:return g.xP(N),N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},s35=function(h,e,t,Q){var N,f,V;
return g.Y(function(R){switch(R.D){case 1:return g.Z(R,pzE([e]),2);case 2:return N=R.K,g.Z(R,tUE(h,N[0],t,Q),3);case 3:return f=R.K,V=zp(f.thumbnailDetails),g.Z(R,l$(V),4);case 4:return R.return(N[0].videos)}})},tUE=function(h,e,t,Q){var N,f,V,R,u,U,q,r,A;
return g.Y(function(z){return z.D==1?(N=e.playlistId,f=YMH(e),V=f.Hv,R=f.FJ,u=t?(Number(t)*1E3).toString():Date.now().toString(),U=e.lastModifiedTimestamp?(Number(e.lastModifiedTimestamp)*1E3).toString():"0",q={id:g.z2(N,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:R,lastModifiedTimestampMillis:U,addedTimestampMillis:u,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},r={id:g.z2(N,"musicPlaylist"),title:e.title,playlistId:N,thumbnailDetails:e.thumbnail,visibility:Q3n(e),trackCount:e.totalVideoCount,
tracks:V,downloadMetadata:q.id},Q&&(((A=r)==null?0:A.entityMetadata)?r.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q):r&&(r.entityMetadata={nextAutoRefreshIntervalSeconds:String(Q)})),g.Z(z,G3(h.D,{mode:"readwrite",sE:!0},function(S){var l=bC(S,r,"musicPlaylist");S=bC(S,q,"musicPlaylistDownloadMetadataEntity");return g.Fu.all([l,S])}),2)):z.return(r)})},Q3n=function(h){switch(h.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},N7c=function(h,e){this.D=h;
this.N=e},j3f=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S;
return g.Y(function(l){switch(l.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,f=g.m(e.actionMetadata,fd9),g.Ik(l,2),g.Z(l,VUc(h,N,void 0,(V=f)==null?void 0:V.track,(R=f)==null?void 0:R.albumRelease),4);case 4:if((u=f)==null?0:u.playlistId){l.Ty(5);break}return g.Z(l,ZMT(h.D,e.entityKey),5);case 5:g.iL(l,3);break;case 2:return U=g.xP(l),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.Tt&&U.type==="QUOTA_EXCEEDED"&&
(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,q,r));case 3:z=Number(((A=e.actionMetadata)==null?void 0:A.priority)||0)+1;var W=(W=g.m(e.actionMetadata,fd9))?{playbackDataActionMetadata:{maximumDownloadQuality:W.maximumDownloadQuality}}:void 0;S=Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N,"playbackData",z,y_f,W);return l.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t,[S]))}})},RSE=function(h,e){var t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W;
return g.Y(function(O){switch(O.D){case 1:return t=jc(e),Q=g.AJ(e.entityKey),N=Q.entityId,g.Z(O,ar(h.D,e.entityKey,"musicTrack"),2);case 2:f=O.K;if(!f){V=void 0;O.Ty(3);break}return g.Z(O,ar(h.D,f.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:V=O.K;case 3:R=V;if(!f||!R)return O.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));U=g.m(e.actionMetadata,fd9);g.Ik(O,5);return g.Z(O,VUc(h,N,R.addedTimestampMillis,(q=U)==null?void 0:q.track,(r=U)==null?void 0:r.albumRelease),
7);case 7:z=Number(((A=e.actionMetadata)==null?void 0:A.priority)||0)+1;u=Fp("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"playbackData",z,y_f);g.iL(O,6);break;case 5:S=g.xP(O);if(!(S instanceof Error&&S.message==="No data")){if(S instanceof Error&&S.message==="Empty response body")tO(S.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.Tt&&S.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),O.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,l,W));O.Ty(6);break}return g.Z(O,Tp(N,h.D,e,h.N),6);case 6:return O.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,u?[u]:void 0))}})},u2F=function(h,e){var t,Q;
return g.Y(function(N){switch(N.D){case 1:return t=jc(e),g.Ik(N,2),Q=g.AJ(e.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.Z(N,gc(h.D,e,h.N),5):g.Z(N,Tp(Q,h.D,e,h.N),6);case 6:return g.Z(N,FNH(h.D,e.entityKey),5);case 5:g.iL(N,3);break;case 2:return g.xP(N),N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new Yd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},VUc=function(h,e,t,Q,N){var f,V,R,u,U,q;
return g.Y(function(r){switch(r.D){case 1:if(f=Q){r.Ty(2);break}return g.Z(r,kLE([e]),3);case 3:V=r.K,R=V[0],f=XzE(R);case 2:return g.Z(r,UzH(h,f,e,N,t),4);case 4:u=r.K;U=u.musicTrackEntity;q=u.oH;var A=zp(U.thumbnailDetails),z=[];q&&(z=zp(q.thumbnailDetails));return g.Z(r,l$(A.concat(z)),0)}})},UzH=function(h,e,t,Q,N){var f;
return g.Y(function(V){return V.D==1?(N||(N=Date.now().toString()),f={id:g.z2(t,"musicTrackDownloadMetadataEntity"),playbackData:g.z2(t,"playbackData"),addedTimestampMillis:N,videoDownloadContextEntity:g.z2(t,"videoDownloadContextEntity")},Q&&(e.albumRelease=Q.id),g.Z(V,G3(h.D,{mode:"readwrite",sE:!0},function(R){var u=[],U=bC(R,f,"musicTrackDownloadMetadataEntity");u.push(U);U=bC(R,e,"musicTrack");u.push(U);Q&&(R=bC(R,Q,"musicAlbumRelease"),u.push(R));return g.Fu.all(u)}),2)):V.D!=3?g.Z(V,qh(t,"musicTrackDownloadMetadataEntity",
h.D,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):V.return({musicTrackEntity:e,
oH:Q})})},vh=function(){Ph.apply(this,arguments);
this.Y="musicTrack"},qyT=function(h,e,t){e=e===void 0?43200:e;
t=t===void 0?!0:t;var Q=Q===void 0?!1:Q;var N,f;return g.Y(function(V){switch(V.D){case 1:if(!h.X.G4())return V.return([]);N=[];g.Ik(V,2);return g.Z(V,BYZ(e,t,Q),4);case 4:N=V.K;g.iL(V,3);break;case 2:g.xP(V);case 3:return f=cdH(h,N,t,"musicPlaylist"),V.return(f)}})},r_T=function(){g.IB.apply(this,arguments);
var h=this;this.events=new g.bZ(this);this.O$=this.player.U();this.gL={pTf:function(){return h.D},
KR:function(){return h.KR()},
jF:function(e){return h.jF(e)}}},A_f=function(h){var e;
h=g.m((e=h.getWatchNextResponse())==null?void 0:e.currentVideoEndpoint,g.Qe);if(h==null?0:h.playlistId)var t=h.playlistId;return t},zSS=function(h,e){var t,Q,N,f;
return g.Y(function(V){if(V.D==1){t=e.clientPlaybackNonce;Q={cpn:t,offlineSourceVisualElement:g.FD(e.jV||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};e.K&&(Q.videoFmt=Number(e.K.itag));e.B&&(Q.audioFmt=Number(e.B.itag));if((N=A_f(e))&&e.videoId){var R=e.videoId;R=N!=="PPSV"?Promise.resolve(!1):h.D.JQ(R);V=g.Z(V,R,3)}else V=V.Ty(2);return V}V.D!=2&&(f=V.K)&&(Q.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");h.K=t;g.Jw("offlinePlaybackStarted",Q);g.cB(V)})};
g.Zs.prototype.gJ=g.eE(51,function(h){return this.app.gJ(h)});
g.JW.prototype.gJ=g.eE(50,function(h){return g.blB(this,9,h)});
g.J(kM,DF);g.V5.Object.defineProperties(kM.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.D.entityMetadata},
set:function(h){this.D.entityMetadata=h}}});
g.J(uVf,kM);uVf.prototype.K=function(){return[]};
g.J(UTL,kM);UTL.prototype.K=function(){return[]};
g.J(q8E,kM);q8E.prototype.K=function(){return[]};
g.J(r6L,kM);r6L.prototype.K=function(){return[]};
g.J(A6T,kM);A6T.prototype.K=function(){var h=[];this.D.alternateChannel&&h.push(this.D.alternateChannel);this.D.alternateChannelList&&h.push.apply(h,g.x(this.D.alternateChannelList));this.D.oneofChannelEntity&&h.push(this.D.oneofChannelEntity);return[].concat(g.x(new Set(h)))};
g.J(zzt,kM);zzt.prototype.K=function(){var h=[];this.D.entryCollection&&h.push(this.D.entryCollection);return[].concat(g.x(new Set(h)))};
g.J(S8Z,DF);S8Z.prototype.K=function(){var h=[];this.D.video&&h.push(this.D.video);return[].concat(g.x(new Set(h)))};
g.J(J6f,kM);J6f.prototype.K=function(){var h=[];this.D.parentPlaylist&&h.push(this.D.parentPlaylist);if(this.D.entries)for(var e=g.c(this.D.entries),t=e.next();!t.done;t=e.next())h.push.apply(h,g.x((new S8Z(t.value)).K()));return[].concat(g.x(new Set(h)))};
g.J(c6F,kM);c6F.prototype.K=function(){var h=[];this.D.descriptionEntity&&h.push(this.D.descriptionEntity);this.D.creators&&h.push.apply(h,g.x(this.D.creators));this.D.theBiggestFan&&h.push(this.D.theBiggestFan);return[].concat(g.x(new Set(h)))};
g.J(IkS,kM);IkS.prototype.K=function(){return[]};
g.J(lkS,kM);lkS.prototype.K=function(){return[]};
g.J(iLH,kM);iLH.prototype.K=function(){return[]};
g.J(xTf,kM);xTf.prototype.K=function(){return[]};
g.J(W7Z,kM);W7Z.prototype.K=function(){return[]};
g.J(TyL,kM);TyL.prototype.K=function(){return[]};
g.J(OL5,kM);OL5.prototype.K=function(){return[]};
g.J(gjn,kM);gjn.prototype.K=function(){return[]};
g.J(dTH,kM);dTH.prototype.K=function(){return[]};
g.J(wrc,kM);wrc.prototype.K=function(){var h=[];this.D.downloadsList&&h.push(this.D.downloadsList);this.D.smartDownloadsList&&h.push(this.D.smartDownloadsList);this.D.recommendedDownloadsList&&h.push(this.D.recommendedDownloadsList);this.D.refresh&&h.push(this.D.refresh);return[].concat(g.x(new Set(h)))};
g.J(XrE,DF);XrE.prototype.K=function(){var h=[];this.D.video&&h.push(this.D.video);this.D.playlist&&h.push(this.D.playlist);this.D.videoItem&&h.push(this.D.videoItem);this.D.playlistItem&&h.push(this.D.playlistItem);return[].concat(g.x(new Set(h)))};
g.J(ZLf,kM);ZLf.prototype.K=function(){var h=[];this.D.refresh&&h.push(this.D.refresh);if(this.D.downloads)for(var e=g.c(this.D.downloads),t=e.next();!t.done;t=e.next())h.push.apply(h,g.x((new XrE(t.value)).K()));return[].concat(g.x(new Set(h)))};
g.J(F7Z,kM);F7Z.prototype.K=function(){var h=[];this.D.localImageEntities&&h.push.apply(h,g.x(this.D.localImageEntities));return[].concat(g.x(new Set(h)))};
g.J(Y8S,kM);Y8S.prototype.K=function(){var h=[];this.D.playbackData&&h.push(this.D.playbackData);this.D.localImageEntities&&h.push.apply(h,g.x(this.D.localImageEntities));this.D.videoDownloadContextEntity&&h.push(this.D.videoDownloadContextEntity);return[].concat(g.x(new Set(h)))};
g.J(njn,kM);njn.prototype.K=function(){return[]};
g.J(DTS,kM);DTS.prototype.K=function(){var h=[];this.D.fakeChildren&&h.push.apply(h,g.x(this.D.fakeChildren));return[].concat(g.x(new Set(h)))};
g.J(kCH,kM);kCH.prototype.K=function(){var h=[];this.D.video&&h.push(this.D.video);this.D.playbackData&&h.push(this.D.playbackData);this.D.offlineVideoPolicy&&h.push(this.D.offlineVideoPolicy);return[].concat(g.x(new Set(h)))};
g.J(prZ,kM);prZ.prototype.K=function(){return[]};
g.J($T9,kM);$T9.prototype.K=function(){var h=[];this.D.channelOwner&&h.push(this.D.channelOwner);this.D.videos&&h.push.apply(h,g.x(this.D.videos));this.D.collaboratorChannels&&h.push.apply(h,g.x(this.D.collaboratorChannels));this.D.downloadState&&h.push(this.D.downloadState);this.D.refresh&&h.push(this.D.refresh);return[].concat(g.x(new Set(h)))};
g.J(K7Z,kM);K7Z.prototype.K=function(){var h=[];this.D.video&&h.push(this.D.video);this.D.channelContributor&&h.push(this.D.channelContributor);return[].concat(g.x(new Set(h)))};
g.J(HLL,DF);HLL.prototype.K=function(){var h=[];this.D.localImageEntities&&h.push.apply(h,g.x(this.D.localImageEntities));this.D.videoDownloadContextEntity&&h.push(this.D.videoDownloadContextEntity);return[].concat(g.x(new Set(h)))};
g.J(EjF,DF);EjF.prototype.K=function(){var h=[];this.D.recommendedVideoMetadata&&h.push.apply(h,g.x((new HLL(this.D.recommendedVideoMetadata)).K()));return[].concat(g.x(new Set(h)))};
g.J(mTE,DF);mTE.prototype.K=function(){var h=[];this.D.playbackPosition&&h.push(this.D.playbackPosition);return[].concat(g.x(new Set(h)))};
g.J(Byt,kM);Byt.prototype.K=function(){var h=[];this.D.owner&&h.push(this.D.owner);this.D.downloadState&&h.push(this.D.downloadState);this.D.userState&&h.push.apply(h,g.x((new mTE(this.D.userState)).K()));this.D.additionalMetadata&&h.push.apply(h,g.x((new EjF(this.D.additionalMetadata)).K()));return[].concat(g.x(new Set(h)))};
g.J(bLc,kM);bLc.prototype.K=function(){var h=[];this.D.userChannelDetails&&h.push(this.D.userChannelDetails);return[].concat(g.x(new Set(h)))};
g.J(PbZ,kM);PbZ.prototype.K=function(){var h=[];this.D.channelOwner&&h.push(this.D.channelOwner);this.D.playbackPosition&&h.push(this.D.playbackPosition);this.D.localImageEntities&&h.push.apply(h,g.x(this.D.localImageEntities));this.D.downloadStatus&&h.push(this.D.downloadStatus);return[].concat(g.x(new Set(h)))};
g.J(Mtn,kM);Mtn.prototype.K=function(){return[]};
g.J(Cb5,kM);Cb5.prototype.K=function(){return[]};
g.J(GCS,kM);GCS.prototype.K=function(){return[]};
g.J(L7t,kM);L7t.prototype.K=function(){return[]};
g.J(akf,kM);akf.prototype.K=function(){return[]};
g.J(vjL,kM);vjL.prototype.K=function(){return[]};
g.J(s7f,kM);s7f.prototype.K=function(){return[]};
g.J(hGL,kM);hGL.prototype.K=function(){return[]};
g.J(oa5,kM);oa5.prototype.K=function(){return[]};
g.J(eGH,kM);eGH.prototype.K=function(){return[]};
g.J(tG5,kM);tG5.prototype.K=function(){return[]};
g.J(Q7S,kM);Q7S.prototype.K=function(){var h=[];this.D.trackDownloadMetadatas&&h.push.apply(h,g.x(this.D.trackDownloadMetadatas));return[].concat(g.x(new Set(h)))};
g.J(NZt,kM);
NZt.prototype.K=function(){var h=[];this.D.downloadedTracks&&h.push.apply(h,g.x(this.D.downloadedTracks));this.D.smartDownloadedTracks&&h.push.apply(h,g.x(this.D.smartDownloadedTracks));this.D.downloadedEpisodes&&h.push.apply(h,g.x(this.D.downloadedEpisodes));this.D.downloadedAlbumReleases&&h.push.apply(h,g.x(this.D.downloadedAlbumReleases));this.D.smartDownloadedAlbumReleases&&h.push.apply(h,g.x(this.D.smartDownloadedAlbumReleases));this.D.downloadedPlaylists&&h.push.apply(h,g.x(this.D.downloadedPlaylists));this.D.smartDownloadedPlaylists&&
h.push.apply(h,g.x(this.D.smartDownloadedPlaylists));this.D.metadataOnlyTracks&&h.push.apply(h,g.x(this.D.metadataOnlyTracks));return[].concat(g.x(new Set(h)))};
g.J(f4S,kM);f4S.prototype.K=function(){var h=[];this.D.trackDownloadMetadatas&&h.push.apply(h,g.x(this.D.trackDownloadMetadatas));return[].concat(g.x(new Set(h)))};
g.J(VGE,kM);VGE.prototype.K=function(){var h=[];this.D.playbackData&&h.push(this.D.playbackData);this.D.localImageEntities&&h.push.apply(h,g.x(this.D.localImageEntities));this.D.videoDownloadContextEntity&&h.push(this.D.videoDownloadContextEntity);return[].concat(g.x(new Set(h)))};
g.J(yaT,kM);yaT.prototype.K=function(){var h=[];this.D.musicLibraryStatusEntity&&h.push(this.D.musicLibraryStatusEntity);this.D.primaryArtists&&h.push.apply(h,g.x(this.D.primaryArtists));this.D.details&&h.push(this.D.details);this.D.userDetails&&h.push(this.D.userDetails);this.D.tracks&&h.push.apply(h,g.x(this.D.tracks));this.D.share&&h.push(this.D.share);this.D.downloadMetadata&&h.push(this.D.downloadMetadata);this.D.refresh&&h.push(this.D.refresh);return[].concat(g.x(new Set(h)))};
g.J(j7T,kM);j7T.prototype.K=function(){var h=[];this.D.albumRelease&&h.push(this.D.albumRelease);this.D.tracks&&h.push.apply(h,g.x(this.D.tracks));return[].concat(g.x(new Set(h)))};
g.J(RGZ,kM);RGZ.prototype.K=function(){var h=[];this.D.albumRelease&&h.push(this.D.albumRelease);return[].concat(g.x(new Set(h)))};
g.J(u05,kM);u05.prototype.K=function(){var h=[];this.D.details&&h.push(this.D.details);this.D.userDetails&&h.push(this.D.userDetails);return[].concat(g.x(new Set(h)))};
g.J(UnE,kM);UnE.prototype.K=function(){var h=[];this.D.parentArtist&&h.push(this.D.parentArtist);return[].concat(g.x(new Set(h)))};
g.J(qt9,kM);qt9.prototype.K=function(){var h=[];this.D.parentArtist&&h.push(this.D.parentArtist);return[].concat(g.x(new Set(h)))};
g.J(raZ,kM);raZ.prototype.K=function(){return[]};
g.J(AaS,kM);AaS.prototype.K=function(){return[]};
g.J(zGF,DF);zGF.prototype.K=function(){var h=[];this.D.creatorEntity&&h.push(this.D.creatorEntity);return[].concat(g.x(new Set(h)))};
g.J(StR,kM);
StR.prototype.K=function(){var h=[];this.D.tracks&&h.push.apply(h,g.x(this.D.tracks));this.D.refresh&&h.push(this.D.refresh);this.D.musicLibraryStatusEntity&&h.push(this.D.musicLibraryStatusEntity);this.D.details&&h.push(this.D.details);this.D.downloadMetadata&&h.push(this.D.downloadMetadata);this.D.sideloadMetadata&&h.push(this.D.sideloadMetadata);this.D.userDetails&&h.push(this.D.userDetails);this.D.entryCollection&&h.push(this.D.entryCollection);this.D.share&&h.push(this.D.share);this.D.podcastShowAdditionalMetadata&&h.push.apply(h,
g.x((new zGF(this.D.podcastShowAdditionalMetadata)).K()));return[].concat(g.x(new Set(h)))};
g.J(Jat,kM);Jat.prototype.K=function(){return[]};
g.J(ca5,kM);
ca5.prototype.K=function(){var h=[];this.D.musicLibraryStatusEntity&&h.push(this.D.musicLibraryStatusEntity);this.D.artists&&h.push.apply(h,g.x(this.D.artists));this.D.audioModeVersion&&h.push(this.D.audioModeVersion);this.D.videoModeVersion&&h.push(this.D.videoModeVersion);this.D.userDetails&&h.push(this.D.userDetails);this.D.details&&h.push(this.D.details);this.D.albumRelease&&h.push(this.D.albumRelease);this.D.share&&h.push(this.D.share);this.D.libraryEdit&&h.push(this.D.libraryEdit);this.D.downloadMetadata&&
h.push(this.D.downloadMetadata);this.D.playbackPosition&&h.push(this.D.playbackPosition);this.D.lyrics&&h.push(this.D.lyrics);return[].concat(g.x(new Set(h)))};
g.J(I4c,kM);I4c.prototype.K=function(){var h=[];this.D.parentTrack&&h.push(this.D.parentTrack);return[].concat(g.x(new Set(h)))};
g.J(l4T,kM);l4T.prototype.K=function(){var h=[];this.D.parentTrack&&h.push(this.D.parentTrack);return[].concat(g.x(new Set(h)))};
g.J(ibZ,kM);ibZ.prototype.K=function(){return[]};
g.J(xnT,kM);xnT.prototype.K=function(){return[]};
g.J(WiF,kM);WiF.prototype.K=function(){return[]};
g.J(TZT,kM);TZT.prototype.K=function(){return[]};
g.J(Obn,kM);Obn.prototype.K=function(){var h=[];this.D.transfer&&h.push(this.D.transfer);this.D.adsPlaybackData&&h.push.apply(h,g.x(this.D.adsPlaybackData));this.D.drmLicense&&h.push(this.D.drmLicense);this.D.offlineVideoPolicy&&h.push(this.D.offlineVideoPolicy);this.D.videoDownloadContextEntity&&h.push(this.D.videoDownloadContextEntity);return[].concat(g.x(new Set(h)))};
g.J(gaS,kM);gaS.prototype.K=function(){return[]};
g.J(dnc,kM);dnc.prototype.K=function(){var h=[];this.D.offlineVideoStreams&&h.push.apply(h,g.x(this.D.offlineVideoStreams));this.D.captionTrack&&h.push.apply(h,g.x(this.D.captionTrack));return[].concat(g.x(new Set(h)))};
g.J(wSZ,kM);wSZ.prototype.K=function(){return[]};
g.J(XSE,kM);XSE.prototype.K=function(){return[]};
g.J(ZbE,kM);ZbE.prototype.K=function(){return[]};
g.J(FiT,kM);FiT.prototype.K=function(){return[]};
g.J(Ytf,kM);Ytf.prototype.K=function(){return[]};
g.J(naT,kM);naT.prototype.K=function(){return[]};
g.J(DnR,kM);DnR.prototype.K=function(){return[]};
g.J(kkL,kM);kkL.prototype.K=function(){return[]};
g.J(pSc,kM);pSc.prototype.K=function(){return[]};
g.J($n9,kM);$n9.prototype.K=function(){return[]};
g.J(KiT,kM);KiT.prototype.K=function(){return[]};
g.J(Hbc,kM);Hbc.prototype.K=function(){return[]};
g.J(Ea5,kM);Ea5.prototype.K=function(){return[]};
g.J(mnE,kM);mnE.prototype.K=function(){return[]};
g.J(BZE,kM);BZE.prototype.K=function(){return[]};
g.J(bbF,kM);bbF.prototype.K=function(){return[]};
g.J(PXL,kM);PXL.prototype.K=function(){return[]};
g.J(MGc,kM);MGc.prototype.K=function(){return[]};
g.J(CXE,kM);CXE.prototype.K=function(){return[]};
var bMf=["browse","music/browse","unplugged/browse"],LNE=["offline/playlist_sync_check"],DgE=["offline"],PgH=["offline/offline_video_playback_position_sync"],Cg5=["offline/get_playback_data_entity"],pI;$M.getInstance=function(){return g.Y(function(h){return h.return(new Promise(function(e){g.Vk().then(function(t){t?($M.instance||($M.instance=new $M(t)),e($M.instance)):e(void 0)})}))})};
$M.prototype.get=function(h){var e=this,t,Q,N;return g.Y(function(f){if(f.D==1)return g.Z(f,vaS(e.token),2);if(f.D!=3)return t=f.K,g.Z(f,t.get("prefs",h),3);Q=f.K;if(!Q)return f.return();N=(0,g.kJ)();return Q.expirationTimestampMs<=N?f.return():f.return(Q.value)})};
$M.prototype.set=function(h,e,t){t=t===void 0?31536E3:t;var Q=this,N,f,V;return g.Y(function(R){if(R.D==1)return N=(0,g.kJ)(),f={key:h,value:e,expirationTimestampMs:N+t*1E3},g.Z(R,vaS(Q.token),2);V=R.K;return g.Z(R,g.m0(V,"prefs",f),0)})};
$M.prototype.remove=function(h){var e=this,t;return g.Y(function(Q){if(Q.D==1)return g.Z(Q,vaS(e.token),2);t=Q.K;return g.Z(Q,t.delete("prefs",h),0)})};
g.J(KI,g.eh);g.J(Hm,tgE);Hm.prototype.N=function(h,e){e=N$L(e);h=(new TextEncoder).encode(JSON.stringify(h));return this.D.encrypt(h,e)};
Hm.prototype.K=function(h,e){if(!(h instanceof Uint8Array))throw sgL(1);var t=new TextDecoder;e=N$L(e);h=this.D.decrypt(h,e);return JSON.parse(t.decode(h))};
var fMn={accountLinkStatusEntity:iLH,booleanEntity:q8E,buttonEntity:Hbc,captionTrack:ibZ,channelHandle:uVf,commerceAcquisitionClientPayloadEntity:mnE,commerceCartListEntity:BZE,contextNoteFeedEntityPayload:UTL,continuationTokenEntity:prZ,downloadQualityPickerEntity:OL5,downloadsPageRefreshTokenEntity:dTH,downloadsPageViewConfigurationEntity:Mtn,downloadStatusEntity:gjn,dismissState:naT,sfvAudioItemCurrentlyPlayingEntity:ZbE,emojiFountainDataEntity:$n9,emojiCustomizationSetEntity:pSc,fakeChannel:A6T,
fakePlaylist:zzt,fakePlaylistEntryCollection:J6f,fakeVideo:c6F,fakeVideoDescription:IkS,featuredProductsEntity:oa5,flowStateEntity:lkS,iconBadgeEntity:bbF,interstitialInteractionStateEntity:W7Z,likeButtonAnimationEntity:Cb5,liveChatPollStateEntity:TyL,liveViewerLeaderboardPointsEntity:XSE,liveReactionsDataEntity:KiT,logoEntity:xTf,macroMarkerEntity:GCS,mainDownloadsLibraryEntity:wrc,mainDownloadsListEntity:ZLf,mainPlaylistDownloadStateEntity:F7Z,mainPlaylistEntity:$T9,mainPlaylistVideoEntity:K7Z,
mainVideoDownloadStateEntity:Y8S,mainVideoEntity:Byt,markersEngagementPanelSyncEntity:L7t,markersVisibilityOverrideEntity:akf,musicAlbumReleaseDetail:j7T,musicAlbumReleaseDownloadMetadataEntity:Q7S,musicAlbumRelease:yaT,musicAlbumReleaseUserDetail:RGZ,musicArtistDetail:UnE,musicArtist:u05,musicArtistUserDetail:qt9,musicDownloadsLibraryEntity:NZt,musicLibraryEdit:raZ,musicLibraryStatusEntity:AaS,musicPlaylist:StR,musicPlaylistDownloadMetadataEntity:f4S,musicShare:Jat,musicTrackDetail:I4c,musicTrackDownloadMetadataEntity:VGE,
musicTrack:ca5,musicTrackUserDetail:l4T,offlineOrchestrationActionWrapperEntity:xnT,offlineVideoPolicy:WiF,offlineVideoStreams:TZT,offlineabilityEntity:njn,orchestrationWebSamplingEntity:DTS,pageHeaderEntity:DnR,pdpStateEntity:PXL,pinnedProductEntity:eGH,playbackData:Obn,playerStateEntity:vjL,quantityIncrementerEntity:MGc,refresh:gaS,saveToPlaylistListEntity:FiT,settingEntity:Ytf,stringEntity:r6L,suggestedFeedbackChipStateEntity:s7f,transfer:dnc,trendingOfferEntity:tG5,videoDownloadContextEntity:wSZ,
videoOverviewAsyncDataEntity:CXE,videoPlaybackPositionEntity:Ea5,votingEntity:kkL,ytMainChannelEntity:bLc,youchatPendingResponseEntity:hGL,ytMainDownloadedVideoEntity:kCH,ytMainVideoEntity:PbZ};g.J(Mt,tgE);Mt.prototype.N=function(h){return h};
Mt.prototype.K=function(h){if(h instanceof Uint8Array)throw sgL(0);return h};
g.J(CI,g.K);CI.prototype.observe=function(h){var e=this;this.observers.push(h);return function(){var t=e.observers.indexOf(h);t>=0&&e.observers.splice(t,1)}};
CI.prototype.K=function(h){IMS(this,h.data)};
CI.prototype.Ks=function(){this.channel.close()};
var T$9,l1S=new g.k1("elementsCommand");var xd=new g.k1("entityBatchUpdate");var jmE=new g.k1("downloadStatusEntity");var Te9=new g.k1("mainPlaylistEntityActionMetadata");var Gp=new g.k1("mainVideoEntityActionMetadata");var nBE=new g.k1("musicPlaylistEntityActionMetadata");var fd9=new g.k1("musicTrackEntityActionMetadata");var HFF=new g.k1("localImageEntityActionMetadata");var nl=new g.k1("playbackDataActionMetadata");var iGT=new g.k1("transferEntityActionMetadata");var Vx9=new g.k1("videoPlaybackPositionEntityActionMetadata");var HSE;new g.WJ;new g.WJ;P_t.prototype.request=function(h,e,t){e=e===void 0?{}:e;return this.locks.request(h,e,function(Q){return t(Q)})};var ec=g.$P.caches,oR,aMZ;hO.prototype.open=function(h){return ec.open(Gy5(h))};
hO.prototype.has=function(h){return ec.has(Gy5(h))};
hO.prototype.delete=function(h){return ec.delete(Gy5(h))};
hO.prototype.match=function(h,e){var t=this,Q,N,f,V,R,u;return g.Y(function(U){switch(U.D){case 1:return g.Z(U,t.keys(),2);case 2:Q=U.K,N=g.c(Q),f=N.next();case 3:if(f.done){U.Ty(5);break}V=f.value;return g.Z(U,t.open(V),6);case 6:return R=U.K,g.Z(U,R.match(h,e),7);case 7:if(u=U.K)return U.return(u);f=N.next();U.Ty(3);break;case 5:return U.return()}})};
g.J(C_n,hO);C_n.prototype.keys=function(){var h,e,t,Q,N,f,V,R,u;return g.Y(function(U){if(U.D==1)return h=[],e=g.tw("CacheStorage keys"),g.Z(U,ec.keys(),2);t=U.K;Q=g.c(t);for(N=Q.next();!N.done;N=Q.next()){f=N.value;var q=f.indexOf(":");V=q===-1?{Cp:f}:{Cp:f.substring(0,q),datasyncId:f.substring(q+1)};R=V.Cp;u=V.datasyncId;u===e&&h.push(R)}return U.return(h)})};g.J(Qd,g.K);Qd.prototype.N=function(h){this.api.hw("onOfflineOperationFailure",h.data)};
Qd.prototype.B=function(h){this.api.publish("offlinetransferpause",h.data)};
Qd.prototype.Ks=function(){var h;(h=this.D)==null||h.close();var e;(e=this.K)==null||e.close()};hif.prototype.Xa=function(){this.D&&fl(this)};
hif.prototype.L5=function(){this.K&&this.K.resolve();this.N=this.D=!1;this.Y()};var $dS=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var J3t="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var wzf="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.J(vBS,ZC);vBS.prototype.K=function(h){return RR(h)?o0t(this,h):u$(h)?Qfn(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g.J(NAS,ZC);NAS.prototype.K=function(h){return u$(h)?f_H(this,h):y3f(h)?yZE(this,h):U1(h)?jfL(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g.y=RhR.prototype;g.y.d5$=function(h){var e=this,t,Q,N,f;return g.Y(function(V){if(!g.M(h.state,128))return V.Ty(0);t=h.state.NN;var R=(Q=t)==null?void 0:Q.errorCode,u=(N=t)==null?void 0:N.P0;f=R==="net.connect"&&u===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(R==null?0:R.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.Z(V,e.Lq(e.player.getVideoData().videoId,f),0)})};
g.y.Lq=function(h,e){var t=this;return g.Y(function(Q){if(Q.D==1){if(t.K)return Q.return();t.K=!0;return e==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(pl(t,h,!1,!0),Q.Ty(0)):g.Z(Q,kd(t,h),3)}g.kY(h,4);return g.Z(Q,t.D.Lq(e),0)})};
g.y.sS=function(h){h.status===2?(h.status!==this.N&&(fiH(this.D),g.kY(h.videoId,2)),h.C0&&uhE(this.D,h.videoId,h.C0)):h.status===4?(kd(this,h.videoId),this.Lq(h.videoId,h.kF?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):h.status===1&&R_R(this.D);this.N=h.status;this.api.hw("localmediachange",{videoId:h.videoId,status:h.status})};
g.y.B1=function(){var h=this,e;return g.Y(function(t){if(t.D==1){if(h.K)return t.return();h.K=!0;e=h.player.getVideoData().videoId;return g.Z(t,kd(h,e),2)}return g.Z(t,h.D.B1(),0)})};
g.y.Pp=function(h){switch(h){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.y.L=function(h){return this.api.U().L(h)};g.J(Src,ZC);Src.prototype.K=function(h){return RR(h)?cZc(this,h):u$(h)?I_L(this,h):y3f(h)?l_F(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g0E.prototype.D=function(h,e){var t=h.action.actionMetadata.priority-e.action.actionMetadata.priority;t===0&&(h.D<e.D?t=-1:h.D>e.D&&(t=1));return t};g.J($d,g.K);$d.prototype.Ks=function(){this.Y&&this.Y();g.K.prototype.Ks.call(this)};
$d.prototype.createAction=function(h,e){var t=g.AJ(h.entityKey).entityType,Q=g.Yh(16);return new Sc(t,Q,h,e.actionId,e.rootActionId)};
$d.prototype.zy=function(h){var e=this,t,Q,N,f,V,R,u,U,q;return g.Y(function(r){if(r.D==1){if(e.VW())return r.return();Q=(t=h.offlineOrchestrationActionWrapperEntity)!=null?t:new Set;N=[];f=g.c(Q);for(V=f.next();!V.done;V=f.next())R=V.value,u=g.AJ(R),U=u.entityId,XUc(e.D,U)||N.push(R);return g.Z(r,E0E(e,N),2)}q=r.K;return g.Z(r,HG5(e,q),0)})};
$d.prototype.retry=function(){var h=this;return g.Y(function(e){return g.Z(e,mdL(h),0)})};bGE.prototype.hd=function(h,e){e=e===void 0?!0:e;var t=this,Q,N,f,V,R,u,U,q;return g.Y(function(r){switch(r.D){case 1:if(!t.D)return r.return();Q=[];N=g.VX(t.D.K,e);f=[];for(V={lW:0};V.lW<N.length;V={lW:V.lW},V.lW++)R=N[V.lW],u=t.D.mQ(R,"json3"),U=g.K2(u,{withCredentials:!0,format:"RAW"},3,500).then(function(A){return function(z){z={metadata:g.lB(N[A.lW]),trackData:z.xhr.responseText};f.push(z)}}(V)).mS(function(A){tO("Caption fetch error",A)}),Q.push(U);
return g.Z(r,RzL(Q),2);case 2:return g.Ik(r,3),g.Z(r,YNF(h,f),5);case 5:g.iL(r,0);break;case 3:q=g.xP(r),tO("Caption DB transaction error",q),g.cB(r)}})};g.J(Kl,g.K);Kl.prototype.Ks=function(){this.K&&this.K();g.K.prototype.Ks.call(this)};
Kl.prototype.N=function(h){var e=this,t,Q,N,f,V,R,u,U;return g.Y(function(q){Q=(t=h.transfer)!=null?t:new Set;N=[];f=g.c(Q);for(V=f.next();!V.done;V=f.next())R=V.value,u=g.AJ(R),U=u.entityId,N.push(U);return N.length===0?q.return():g.Z(q,CxR(e,N),0)})};g.J(sL9,g.K);g.y=sL9.prototype;g.y.Ks=function(){this.gy&&this.gy();this.kR.dispose();this.B.dispose();this.Aw&&g.L6(this.X.WO,this.Aw);this.Jw&&g.L6(this.X.WO,this.Jw);g.K.prototype.Ks.call(this)};
g.y.hZy=function(h){var e=this,t,Q,N;return g.Y(function(f){switch(f.D){case 1:t=g.z2(h,"transfer");if(e.D&&t===e.D.key){pl(e.J,e.V,!0);e.B.stop();f.Ty(0);break}return g.Z(f,G3(e.K,{mode:"readwrite",sE:!0},function(V){return Ef(V,t,"transfer").then(function(R){if(R&&R.transferState!=="TRANSFER_STATE_COMPLETE"&&R.transferState!=="TRANSFER_STATE_FAILED")return R.transferState="TRANSFER_STATE_PAUSED_BY_USER",bC(V,R,"transfer").then(function(){return R})})}),3);
case 3:Q=f.K;if(!Q){f.Ty(0);break}if(!h||!e.N){f.Ty(5);break}return g.Z(f,qh(h,e.N,e.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.Z(f,mj(e,h),7);case 7:N=f.K,f1c({videoId:h,jI:Q,offlineModeType:N}),g.cB(f)}})};
g.y.MqX=function(){var h=this;if(this.D&&this.V){pl(this.J,this.V,!1);var e=this.D,t=(e==null?0:e.key)?g.AJ(e.key).entityId:"";t&&this.N&&(new Promise(function(Q,N){qh(t,h.N,h.K,"DOWNLOAD_STATE_PAUSED").catch(function(f){N(f)})})).catch(function(Q){tO("Download state setting error",Q)})}this.B.stop()};
g.y.yB=function(){this.D?e_L(this,this.D):E1(this)};
g.y.rP=function(h){var e=this;return g.Y(function(t){switch(t.D){case 1:if(!e.D){t.Ty(2);break}if(e.D.transferState==="TRANSFER_STATE_COMPLETE"||e.D.transferState==="TRANSFER_STATE_FAILED"||!h.transfer||!h.transfer.has(e.D.key)){t.Ty(3);break}return g.Z(t,ar(e.K,e.D.key,"transfer"),4);case 4:e.D=t.K;if(e.D){t.Ty(3);break}return g.Z(t,t4R(e),3);case 3:if(e.D)return t.return();case 2:return g.Z(t,E1(e),0)}})};
g.y.Lq=function(h,e){var t=this,Q,N,f,V,R;return g.Y(function(u){switch(u.D){case 1:if(!t.D){Bh(t,"onTransferFailure: "+h);u.Ty(2);break}Q=t.D;f=((N=Q)==null?0:N.key)?g.AJ(Q.key).entityId:"";a:switch(h){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var U=!1;break a;default:U=!0}return U&&UHR(t)?g.Z(u,b$(t,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.Z(u,
qTc(t,h),5);case 5:if(!f||!t.N){u.Ty(2);break}return g.Z(u,qh(f,t.N,t.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.Z(u,mj(t,f),9);case 9:V=u.K;yd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:f,jI:Q,offlineModeType:V});if(!f||!t.N){u.Ty(2);break}return g.Z(u,qh(f,t.N,t.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Hh(t),R=E1(t,!0),e&&e(R),g.cB(u)}})};
g.y.B1=function(h){var e=this,t,Q,N,f,V,R,u,U,q,r,A,z;return g.Y(function(S){switch(S.D){case 1:if(!e.D){Bh(e,"onMaybeTransferStreamsExpired");S.Ty(2);break}return UHR(e)?g.Z(S,b$(e,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.Z(S,qTc(e,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!e.N){S.Ty(2);break}t=e.D;N=((Q=t)==null?0:Q.key)?g.AJ(t.key).entityId:"";if(!N){S.Ty(2);break}return g.Z(S,qh(N,e.N,e.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return e.D||Bh(e,"onMaybeTransferStreamsExpiredRetryAttempting"),
f=e.D,R=((V=f)==null?0:V.key)?g.AJ(f.key).entityId:"",g.Z(S,mj(e,R),10);case 10:return u=S.K,yd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:R,jI:f,offlineModeType:u}),U=UgS(),g.Ln(U,nl,{isEnqueuedForExpiredStreamUrlRefetch:!0}),q=g.z2(R,"playbackData"),r={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:q,actionMetadata:U},A=ch(new Sc("playbackData",R,r)),g.Z(S,LI(e.K,A,"offlineOrchestrationActionWrapperEntity"),2);case 2:Hh(e),z=E1(e,!0),
h&&h(z),g.cB(S)}})};
var Syf={},rdf=(Syf.TRANSFER_STATE_TRANSFERRING=1,Syf.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Syf);g.y=Ph.prototype;g.y.x8=function(){return this.V.promise};
g.y.tv=function(){if(this.K&&this.J)return this.V.promise;STf(this).then(this.V.resolve).catch(this.V.reject);return this.V.promise};
g.y.C1=function(h){var e={};return e.playbackData=new vBS(h,this.O$,this.D),e.transfer=new Src(h,this.O$),e.videoPlaybackPositionEntity=new NAS(h,this.O$),e};
g.y.nE=function(){var h=this;return g.Y(function(e){return h.K?g.Z(e,h_H(h.K),0):e.Ty(0)})};
g.y.Av=function(){var h=this,e,t;return g.Y(function(Q){if(Q.D==1)return h.K||h.J?g.Z(Q,h.x8(),2):Q.return();h.W!==void 0&&(g.dG(h.W),h.W=void 0);h.B!==void 0&&(g.dG(h.B),h.B=void 0);(e=h.K)==null||e.dispose();h.K=void 0;(t=h.J)==null||t.dispose();h.J=void 0;h.api.hw("onOrchestrationLostLeader");h.V=new g.WJ;g.cB(Q)})};
g.y.isOrchestrationLeader=function(){return this.N.D};
g.y.JQ=function(){return g.Y(function(h){return h.return(!1)})};
g.y.xq=function(h){var e=this.D;e.api.publish("offlinetransferpause",h);var t;(t=e.K)==null||t.postMessage(h)};
g.y.yB=function(h){var e,t;return g.Y(function(Q){if(Q.D==1)return g.Z(Q,s1(),2);e=Q.K;if(!e)return Q.return();t=g.z2(h,"transfer");return g.Z(Q,G3(e,{mode:"readwrite",sE:!0},function(N){var f=Ef(N,t,"transfer"),V=Ef(N,g.z2(h,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Fu.all([f,V]).then(function(R){R=g.c(R);var u=R.next().value;var U=R.next().value;return u&&u.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(u.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",bC(N,u,"transfer").then(function(){yd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:h,jI:u,offlineModeType:U==null?void 0:U.offlineModeType});return g.Fu.resolve(null)})):g.Fu.resolve(null)})}),0)})};
g.y.Na=function(h){h=h===void 0?43200:h;var e=this,t,Q,N,f,V,R,u,U;return g.Y(function(q){if(q.D==1)return e.X.G4()?g.Z(q,s1(),2):q.return(Jd9());if(q.D!=3){t=q.K;if(!t)return q.return([]);Q=Date.now()/1E3;return g.Z(q,vm(t,"offlineVideoPolicy"),3)}N=q.K;f=[];V=g.c(N);for(R=V.next();!R.done;R=V.next())u=R.value,Number(u.lastUpdatedTimestampSeconds)+h<=Q&&(U=g.AJ(u.key).entityId,f.push(U));return f.length?q.return(Mh(e,f,e.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):q.return([])})};
g.y.deleteAll=function(){return Mh(this,["!*$_ALL_ENTITIES_!*$"],this.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.y.refreshAllStaleEntities=function(h){var e=this;return g.Y(function(t){return t.D==1?g.Z(t,e.Na(h),2):t.return(t.K)})};
g.y.setUpPositionSyncInterval=function(h){var e=this;this.B!==void 0&&(g.dG(this.B),this.B=void 0);var t=h!=null?h:864E5;this.B=g.OQ(function(){e.Bs(t)},t)};
g.y.Bs=function(h){var e=this,t,Q,N,f,V,R;return g.Y(function(u){switch(u.D){case 1:return g.Ik(u,2),g.Z(u,$M.getInstance(),4);case 4:t=u.K;if(!t)throw Error("prefStorage is undefined");return g.Z(u,t.get("psi"),5);case 5:Q=u.K;f=((N=Q)==null?0:N.BZ)?Number(Q.BZ)/1E3:0;V=Date.now();if(!(f+h<=V)){u.Ty(6);break}return g.Z(u,Mh(e,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.iL(u,0);break;case 2:R=g.xP(u),tO("Offline manager error",R),
g.cB(u)}})};
g.y.Ev=function(){var h=this,e,t,Q,N,f,V,R;return g.Y(function(u){if(u.D==1)return g.Z(u,s1(),2);if(u.D!=3)return(e=u.K)?g.Z(u,vm(e,"transfer"),3):u.return([]);t=u.K;Q=[];N=g.c(t);for(f=N.next();!f.done;f=N.next())V=f.value,V.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&V.key&&(R=g.AJ(V.key).entityId,Q.push(R));return u.return(Ii9(h,Q))})};
g.y.cX=function(){return g.Y(function(h){return h.return([])})};
g.y.Ej=function(){return g.Y(function(h){g.cB(h)})};
g.y.wq=function(){return g.Y(function(h){g.cB(h)})};g.J(liF,ZC);liF.prototype.K=function(h){return RR(h)?WMF(this,h):u$(h)?OFE(this,h):U1(h)?geE(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var Cl=[10];g.J(FML,ZC);FML.prototype.K=function(h){return RR(h)?DH5(this,h):u$(h)?kVE(this,h):U1(h)?p_f(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var nec=[10];g.J(KML,ZC);KML.prototype.K=function(h){return u$(h)?Eet(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g.J(mHn,Ph);g.y=mHn.prototype;g.y.C1=function(h){var e=Ph.prototype.C1.call(this,h);e.mainVideoEntity=new FML(h,this.O$,this.D);e.mainPlaylistEntity=new liF(h,this.O$,this.D);e.mainDownloadsListEntity=new KML(h,this.O$,this.D);return e};
g.y.refreshAllStaleEntities=function(h,e){var t=this,Q,N,f,V,R,u,U,q,r,A,z;return g.Y(function(S){switch(S.D){case 1:Q=[];if(!t.O$.L("web_player_offline_playlist_auto_refresh")){S.Ty(2);break}return g.Z(S,Bec(t,h,e),3);case 3:Q=S.K;case 2:return g.Z(S,$M.getInstance(),4);case 4:return N=S.K,g.Z(S,(f=N)==null?void 0:f.get("sdois"),5);case 5:return V=S.K,g.Z(S,(R=N)==null?void 0:R.get("lmqf"),6);case 6:u=S.K;if(!V){S.Ty(7);break}q=Q;r=q.concat;return g.Z(S,bFT(t,V,(U=u)!=null?U:"SD",h===0),8);case 8:Q=
r.call(q,S.K);case 7:return A=Q,z=A.concat,g.Z(S,Ph.prototype.refreshAllStaleEntities.call(t,h,e),9);case 9:return Q=z.call(A,S.K),S.return(Q)}})};
g.y.JQ=function(h){var e,t,Q,N,f,V,R,u;return g.Y(function(U){if(U.D==1)return g.Z(U,s1(),2);if(U.D!=3)return(e=U.K)?g.Z(U,ar(e,g.nN,"mainDownloadsListEntity"),3):U.return(!1);t=U.K;if((Q=t)==null?0:(N=Q.downloads)==null?0:N.length)for(f=g.z2(h,"mainVideoEntity"),V=g.c(t.downloads),R=V.next();!R.done;R=V.next())if(u=R.value,u.videoItem===f)return U.return(!0);return U.return(!1)})};
g.y.cX=function(){var h=this,e,t,Q,N,f,V,R,u;return g.Y(function(U){if(U.D==1)return g.Z(U,s1(),2);if(U.D!=3)return(e=U.K)?g.Z(U,vm(e,"downloadStatusEntity"),3):U.return([]);t=U.K;Q=[];N=g.c(t);for(f=N.next();!f.done;f=N.next())V=f.value,V.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&V.key&&(R=g.AJ(V.key).entityId,Q.push(R));return Q.length?(u={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},U.return(Mh(h,Q,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
u))):U.return([])})};
g.y.wq=function(){var h;return g.Y(function(e){return e.D==1?g.Z(e,s1(),2):(h=e.K)?g.Z(e,G3(h,{mode:"readwrite",sE:!0},function(t){return mH(t,"mainVideoEntity").then(function(Q){var N=[];Q=g.c(Q);for(var f=Q.next();!f.done;f=Q.next()){f=f.value;var V=void 0;(V=f.userState)!=null&&V.playbackPosition||(V=g.AJ(f.key).entityId,V={key:g.z2(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:"0"},N.push(bC(t,V,"videoPlaybackPositionEntity")),f.userState={playbackPosition:V.key},N.push(bC(t,
f,"mainVideoEntity")))}return g.Fu.all(N)})}),0):e.return()})};
g.y.Ej=function(){var h,e,t,Q,N,f,V,R,u,U,q,r,A,z,S,l,W,O,w,F,k,E,G,C,t$,fv,sU,B,v,I,b,Kv,IE,UL,OU,Lv,QT,At;return g.Y(function(T){if(T.D==1)return g.Z(T,s1(),2);if(T.D!=3){h=T.K;if(!h)return T.return();e=g.z2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.Z(T,G3(h,{mode:"readonly",sE:!0},function(d){return g.Fu.all([Ef(d,e,"mainDownloadsListEntity"),Ef(d,g.nN,"mainDownloadsListEntity"),mH(d,"mainVideoEntity"),mH(d,"mainPlaylistEntity")])}),3)}t=T.K;
Q=g.c(t);N=Q.next().value;f=Q.next().value;V=Q.next().value;R=Q.next().value;u=N;U=f;q=V;r=R;A=new Set;if((z=u)==null?0:(S=z.downloads)==null?0:S.length)for(l=g.c(u.downloads),W=l.next();!W.done;W=l.next())O=W.value,w=void 0,(F=(w=O.videoItem)!=null?w:O.playlistItem)&&A.add(F);if((k=U)==null?0:(E=k.downloads)==null?0:E.length)for(G=g.c(U.downloads),C=G.next();!C.done;C=G.next())t$=C.value,t$.videoItem&&A.add(t$.videoItem);fv=new Set;sU=[];B=g.c(r);for(v=B.next();!v.done;v=B.next()){I=v.value;if(I.videos)for(b=
g.c(I.videos),Kv=b.next();!Kv.done;Kv=b.next())IE=Kv.value,(UL=JSON.parse(g.AJ(IE).entityId).videoId)&&fv.add(UL);I.key&&!A.has(I.key)&&sU.push(I.key)}OU=g.c(q);for(Lv=OU.next();!Lv.done;Lv=OU.next())QT=Lv.value,QT.key&&!A.has(QT.key)&&(At=g.AJ(QT.key).entityId,fv.has(At)||sU.push(QT.key));return sU.length?g.Z(T,TYt(h,sU),0):T.Ty(0)})};g.J(P25,ZC);P25.prototype.K=function(h){return RR(h)?C2n(this,h):u$(h)?GVZ(this,h):U1(h)?LML(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var Ll=[10];g.J(veZ,ZC);veZ.prototype.K=function(h){return RR(h)?hSn(this,h):u$(h)?o1T(this,h):U1(h)?eST(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var aR=[10];g.J(N7c,ZC);N7c.prototype.K=function(h){return RR(h)?j3f(this,h):u$(h)?RSE(this,h):U1(h)?u2F(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var y_f=[10];g.J(vh,Ph);vh.prototype.C1=function(h){var e=Ph.prototype.C1.call(this,h);e.musicTrack=new N7c(h,this.D);e.musicPlaylist=new veZ(h,this.D);e.musicAlbumRelease=new P25(h,this.D);return e};
vh.prototype.refreshAllStaleEntities=function(h,e){var t=this,Q,N,f;return g.Y(function(V){if(V.D==1)return g.Z(V,qyT(t,h,e),2);if(V.D!=3)return N=Q=V.K,f=N.concat,g.Z(V,Ph.prototype.refreshAllStaleEntities.call(t,h,e),3);Q=f.call(N,V.K);return V.return(Q)})};g.J(r_T,g.IB);g.y=r_T.prototype;g.y.create=function(){var h=this;g.H(this,this.events);g.e9(this.O$)?this.D=new mHn(this.O$,this.player):g.Py(this.O$)&&(this.D=new vh(this.O$,this.player));this.events.G(this.player,"onPlaybackStartExternal",function(){h.KR()});
this.events.G(this.player,"videodatachange",function(){h.KR()});
this.O$.L("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.jF)};
g.y.mI=function(){return!1};
g.y.BD=function(h,e,t,Q){var N=this;return g.Y(function(f){return N.D?f.return(Mh(N.D,h,e,t,Q)):f.return(Promise.reject())})};
g.y.deleteAll=function(){return this.D.deleteAll()};
g.y.Na=function(h){return this.D.Na(h)};
g.y.refreshAllStaleEntities=function(h){return this.D.refreshAllStaleEntities(h)};
g.y.setUpPositionSyncInterval=function(h){this.D.setUpPositionSyncInterval(h)};
g.y.xq=function(h){this.D.xq(h)};
g.y.yB=function(h){return this.D.yB(h)};
g.y.KR=function(){var h=this,e;return g.Y(function(t){e=h.player.getVideoData();return g.QY(e)?A_f(e)&&h.K!==e.clientPlaybackNonce?g.Z(t,zSS(h,e),0):t.Ty(0):t.return()})};
g.y.jF=function(h){var e=this,t,Q,N,f,V,R,u;return g.Y(function(U){if(U.D==1)return t=e.player.getVideoData(),Q=t.U$,g.xZ(h,2)||g.xZ(h,512)?g.Z(U,s1(),2):U.return();if(U.D!=3){N=U.K;if(!N)return tO("PES is undefined"),U.return();f=t.videoId;return g.Z(U,ar(N,g.z2(f,"mainVideoEntity"),"mainVideoEntity"),3)}V=U.K;if(!V)return U.return();R=Math.floor(Q).toString();u={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:R}};return g.Z(U,e.BD([f],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
u),0)})};
g.y.isOrchestrationLeader=function(){return this.D.isOrchestrationLeader()};
g.y.updateDownloadState=function(h,e){var t,Q,N,f;return g.Y(function(V){if(V.D==1)return g.Z(V,s1(),2);t=V.K;if(!t)return tO("PES is undefined"),V.return();Q=g.AJ(h);N=Q.entityType;f=Q.entityId;return g.Z(V,qh(f,N,t,e,!0),0)})};g.c3("offline",r_T);})(_yt_player);
